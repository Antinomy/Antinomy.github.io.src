<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>Anti</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Anti">
<meta property="og:url" content="http://yoursite.com/page/2/index.html">
<meta property="og:site_name" content="Anti">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Anti">
  
    <link rel="alternate" href="/atom.xml" title="Anti" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Anti</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Suche"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="mobile-Art-2016-2016-09-02-AgileTest" class="article article-type-mobile" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/09/02/Art-2016-2016-09-02-AgileTest/" class="article-date">
  <time datetime="2016-09-02T02:23:01.000Z" itemprop="datePublished">2016-09-02</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Tech/">Tech</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/09/02/Art-2016-2016-09-02-AgileTest/">Four-quadrant diagram and ROI</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="四象限图与ROI"><a href="#四象限图与ROI" class="headerlink" title="四象限图与ROI"></a>四象限图与ROI</h1><p>读完这本《敏捷软件测试》，印象最深刻莫过于测试的象限图。  </p>
<h1 id="四象限图"><a href="#四象限图" class="headerlink" title="四象限图"></a>四象限图</h1><p><img src="/img/2016/AgileTest1.png" width="800"></p>
<p>从象限图里，可以知道测试的类型有多少种，什么时候应该执行那种测试。<br>什么样的时候应该自动化，什么样的时候不应该测试。  </p>
<h1 id="ROI-（投资回报率）"><a href="#ROI-（投资回报率）" class="headerlink" title="ROI （投资回报率）"></a>ROI （投资回报率）</h1><p>衡量某种测试是否值得去做自动化的关键指标就是ROI （投资回报率）。<br>API接口和核心业务属于相对较稳定的部分，实现自动化测试的回报率也高。  </p>
<h1 id="自动化"><a href="#自动化" class="headerlink" title="自动化"></a>自动化</h1><p>敏捷项目依赖于自动化，离开自动化的项目不能称之为敏捷项目。<br>自动化单元测试的基石是TDD，离开TDD的方式去实现自动化单元测试，ROI也是低下的。  </p>
<p><img src="/img/2016/AgileTest2.png" width="800"></p>
<h1 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h1><p>*《敏捷软件测试》  </p>
<p><img src="https://img3.doubanio.com/lpic/s22778583.jpg" alt="img"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/09/02/Art-2016-2016-09-02-AgileTest/" data-id="cjf9gd89g001wvzzns829hjas" class="article-share-link">Teilen</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="mobile-Tech-2015-2015-07-15-Cucumber-BDD" class="article article-type-mobile" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/04/06/Tech-2015-2015-07-15-Cucumber-BDD/" class="article-date">
  <time datetime="2016-04-06T03:54:12.000Z" itemprop="datePublished">2016-04-06</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Tech/">Tech</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/04/06/Tech-2015-2015-07-15-Cucumber-BDD/">Cucumber-BDD</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Cucumber-行为驱动指南"><a href="#Cucumber-行为驱动指南" class="headerlink" title="Cucumber : 行为驱动指南"></a>Cucumber : 行为驱动指南</h1><p><img src="http://img3.douban.com/lpic/s26814749.jpg" alt="img"></p>
<h1 id="为什么要用Cucumber？"><a href="#为什么要用Cucumber？" class="headerlink" title="为什么要用Cucumber？"></a>为什么要用Cucumber？</h1><p>Cucumber是一个实现BDD（行为驱动指南）的工具，为什么要使用它呢？  </p>
<p>软件始于一个想法。  </p>
<p>但是，如果一个开发人员误解的一个想法，然后花了2周的一次迭代实现了它，那么他不仅仅浪费了2周的时间，还引入一些误解最初想法的概念和功能，破坏了代码的完整性。  </p>
<p>这就是cucumber要解决的问题，作为一种过滤器，过滤那些被误解的想法。  </p>
<h2 id="自动化验收测试"><a href="#自动化验收测试" class="headerlink" title="自动化验收测试"></a>自动化验收测试</h2><p>单元测试确保你正确地编写软件，验收测试确保你编写正确地软件。</p>
<h2 id="通用语言"><a href="#通用语言" class="headerlink" title="通用语言"></a>通用语言</h2><p>Cucumber为存在语言分歧的双方，提供可以发现和使用通用语言的场所。</p>
<h2 id="活的文档"><a href="#活的文档" class="headerlink" title="活的文档"></a>活的文档</h2><p>用Cucumber编写的文档，是可执行的规格说明（executable specification），</p>
<p><em>Overview</em><br><img src="/img/2015/cucumber-overview.png" alt="img">  </p>
<h1 id="Gherkin基础"><a href="#Gherkin基础" class="headerlink" title="Gherkin基础"></a>Gherkin基础</h1><p><img src="/img/2015/cucumber-feature.png" alt="img">  </p>
<p>Gherkin是一种DSL，是可执行的规格说明。它以.feature为后缀名，以简单文本格式保存。</p>
<h2 id="关键字"><a href="#关键字" class="headerlink" title="关键字"></a>关键字</h2><ul>
<li>Feature</li>
<li>Background</li>
<li>Scenario</li>
<li>Scenario outline</li>
<li>Scenarios (or examples)</li>
<li>Given</li>
<li>When</li>
<li>Then</li>
<li>And (or But)</li>
<li>| (用来定义表格)</li>
<li>“”” (定义多行字符串)</li>
<li><h1 id="注释"><a href="#注释" class="headerlink" title="(注释)"></a>(注释)</h1></li>
</ul>
<h2 id="模拟运行"><a href="#模拟运行" class="headerlink" title="模拟运行"></a>模拟运行</h2><pre><code>$ cucumber test.feature --dry-run
</code></pre><p>解析不执行</p>
<h2 id="Feature"><a href="#Feature" class="headerlink" title="Feature"></a>Feature</h2><p>每一个Gherkin文件都以Feature关键字开头。<br>它只是提供一个地方，放置与测试相关的摘要文档。  </p>
<p>合法的Gherkin必须包含以下其中一个元素：  </p>
<ul>
<li>Scenario </li>
<li>Background</li>
<li>Scenario outline</li>
</ul>
<h2 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h2><p>场景是特定情形下有关系统行为的具体实例，所有的场景会和起来就是这个特性期望的行为。</p>
<h3 id="无状态"><a href="#无状态" class="headerlink" title="无状态"></a>无状态</h3><pre><code>每个场景都必须有独立的意义，且能够不依赖其他场景独立运行。
</code></pre><h3 id="多语言支持"><a href="#多语言支持" class="headerlink" title="多语言支持"></a>多语言支持</h3><p>Cucumber支持多国语言来编写 , 以下目录显示所有支持的语言  </p>
<pre><code>$ cucumber --i18n help
</code></pre><h2 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h2><p>场景中的每一行都是一个步骤</p>
<h3 id="Given、When、Then"><a href="#Given、When、Then" class="headerlink" title="Given、When、Then"></a>Given、When、Then</h3><p>Given 用来建立场景发生的上下文<br>When 以某种方式与系统交互<br>Then 检查交互的结果是否符合预期  </p>
<h3 id="And、But"><a href="#And、But" class="headerlink" title="And、But"></a>And、But</h3><p>使用And／But 可以为Given、When、Then增加更多的步骤。</p>
<h3 id="星号（＊）"><a href="#星号（＊）" class="headerlink" title="星号（＊）"></a>星号（＊）</h3><p>不想用Given、When、Then的时候，每一行都是＊开始就行。</p>
<h3 id="注释（＃）"><a href="#注释（＃）" class="headerlink" title="注释（＃）"></a>注释（＃）</h3><pre><code>#comment sth
</code></pre><h1 id="步骤定义"><a href="#步骤定义" class="headerlink" title="步骤定义"></a>步骤定义</h1><p><img src="/img/2015/cucumber-step.png" alt="img">  </p>
<p>步骤定义在业务领域和编程领域的边界上。  </p>
<h2 id="两面"><a href="#两面" class="headerlink" title="两面"></a>两面</h2><p>对外把普通语言翻译成程序，对内使用自动化代码告诉系统做什么。</p>
<h2 id="步骤与步骤定义"><a href="#步骤与步骤定义" class="headerlink" title="步骤与步骤定义"></a>步骤与步骤定义</h2><p>步骤只是用普通语言编写的文档，步骤定义赋予其生命。</p>
<h2 id="匹配步骤"><a href="#匹配步骤" class="headerlink" title="匹配步骤"></a>匹配步骤</h2><p>Cucumber扫描每个步骤的文本，通过<em>正则表达式</em>来寻找对应的步骤定义。</p>
<h3 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h3><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Feature</span>: 网页搜索</span><br><span class="line"></span><br><span class="line">  <span class="keyword">Scenario</span>: 在百度里搜索谷歌</span><br><span class="line">    <span class="keyword">Given</span> 打开浏览器到baidu.com</span><br><span class="line">    <span class="keyword">And</span> 输入 <span class="string">"google"</span></span><br><span class="line">    <span class="keyword">When</span> 点击百度一下</span><br><span class="line">    <span class="keyword">Then</span> 见到搜索结果</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by Antinomy on 15/6/10.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cucumber.api.CucumberOptions;</span><br><span class="line"><span class="keyword">import</span> cucumber.api.java.en.*;</span><br><span class="line"><span class="keyword">import</span> cucumber.api.junit.Cucumber;</span><br><span class="line"><span class="keyword">import</span> domian.driver.Brower;</span><br><span class="line"><span class="keyword">import</span> domian.lifeCycle.PageConfRepository;</span><br><span class="line"><span class="keyword">import</span> org.apache.log4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.junit.runner.RunWith;</span><br><span class="line"><span class="keyword">import</span> org.openqa.selenium.By;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.net.MalformedURLException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.hamcrest.MatcherAssert.assertThat;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.hamcrest.core.Is.is;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RunWith</span>(Cucumber.class)</span><br><span class="line"><span class="meta">@CucumberOptions</span>(plugin = &#123;<span class="string">"pretty"</span>, <span class="string">"html:target/cucumber"</span>&#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BaiduExample_Test</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Brower brower;</span><br><span class="line">    <span class="keyword">private</span> PageConfRepository page;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Logger logger = Logger.getLogger(Brower.class);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BaiduExample_Test</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">        page = <span class="keyword">new</span> PageConfRepository(<span class="string">"baiduExample.yaml"</span>);</span><br><span class="line"></span><br><span class="line">        brower = Brower.getInstance();</span><br><span class="line">        brower.open();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Given</span>(<span class="string">"打开浏览器到baidu.com"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">go_to_baidu_com</span><span class="params">()</span> <span class="keyword">throws</span> MalformedURLException </span>&#123;</span><br><span class="line">        logger.debug(<span class="string">"打开浏览器到baidu.com"</span>);</span><br><span class="line"></span><br><span class="line">        brower.go(page.getConf(<span class="string">"baiduPage"</span>, <span class="string">"url"</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@And</span>(<span class="string">"^输入 \"(.*?)\"$"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">input_in_text</span><span class="params">(String keyWord)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        logger.debug(<span class="string">"输入 "</span> + keyWord);</span><br><span class="line"></span><br><span class="line">        brower.inputText(page.getId(<span class="string">"baiduPage"</span>, <span class="string">"input_id"</span>), keyWord);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@When</span>(<span class="string">"^点击百度一下$"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">he_click_the_search_buttom</span><span class="params">()</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        logger.debug(<span class="string">"点击百度一下"</span>);</span><br><span class="line"></span><br><span class="line">        brower.click(page.getId(<span class="string">"baiduPage"</span>, <span class="string">"searchBtn_id"</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Then</span>(<span class="string">"^见到搜索结果$"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">he_should_be_see_search_result</span><span class="params">()</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        logger.debug(<span class="string">"见到搜索结果"</span>);</span><br><span class="line"></span><br><span class="line">        assertThat(brower.getTitle(), is(<span class="string">"google_百度搜索"</span>));</span><br><span class="line">        brower.close();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h3 id="正则表达式"><a href="#正则表达式" class="headerlink" title="正则表达式"></a>正则表达式</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@And</span>(<span class="string">"^输入 \"(.*?)\"$"</span>)</span><br></pre></td></tr></table></figure>
<pre><code>捕获组（A｜B）：  用（）包围的那部分，加上｜可多选分支 
点号（.）:  匹配单个任意字符
星号（＊）： 任意多次
加号（＋）： 至少一次
问号（？）： 0或1次
字符组：
\d 代表数字，［0-9］
\w 代表单词字符 ［A－Za－z0-9］
\s 代表空白字符 ［\t\r\n］
\b 代表单词边界，任何不是单词字符的都是单词边界
大写则是代表相反结果，如\D表示任意非数字字符
</code></pre><p>非捕获组就是正则表达式之外的那部分。如例子里的“输入”。    </p>
<h3 id="锚点"><a href="#锚点" class="headerlink" title="锚点"></a>锚点</h3><p>步骤 以 ^开头 $结尾 ，保持紧凑。</p>
<h2 id="Given、When、Then是相等的"><a href="#Given、When、Then是相等的" class="headerlink" title="Given、When、Then是相等的"></a>Given、When、Then是相等的</h2><pre><code>Cucumber在匹配步骤的时候是忽略这几个关键字的。
</code></pre><h2 id="返回结果"><a href="#返回结果" class="headerlink" title="返回结果"></a>返回结果</h2><ul>
<li>未定义 (undefined)</li>
<li>待定 (pending)</li>
<li>失败 (failed)</li>
<li>通过 (passed)</li>
</ul>
<p><img src="/img/2015/cucumber-result.png" alt="img">  </p>
<h1 id="富有表现力的场景"><a href="#富有表现力的场景" class="headerlink" title="富有表现力的场景"></a>富有表现力的场景</h1><h2 id="背景-（Background）"><a href="#背景-（Background）" class="headerlink" title="背景 （Background）"></a>背景 （Background）</h2><p>背景： 指定一组所有场景的公共步骤，相当于Junit里的@Before</p>
<ul>
<li>不设置复杂状态</li>
<li>保持简短</li>
<li>鲜明生动</li>
<li>避免技术细节</li>
</ul>
<figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Feature</span>: Multiple site support</span><br><span class="line">  As a Mephisto site owner</span><br><span class="line">  I want to host blogs for different people</span><br><span class="line">  In order to make gigantic piles of money</span><br><span class="line"></span><br><span class="line">  <span class="keyword">Background</span>:</span><br><span class="line">    <span class="keyword">Given</span> a global administrator named <span class="string">"Greg"</span></span><br><span class="line">    <span class="keyword">And</span> a blog named <span class="string">"Greg's anti-tax rants"</span></span><br><span class="line">    <span class="keyword">And</span> a customer named <span class="string">"Dr. Bill"</span></span><br><span class="line">    <span class="keyword">And</span> a blog named <span class="string">"Expensive Therapy"</span> owned by <span class="string">"Dr. Bill"</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">Scenario</span>: Dr. Bill posts to his own blog</span><br><span class="line">    <span class="keyword">Given</span> I am logged in as Dr. Bill</span><br><span class="line">    <span class="keyword">When</span> I try to post to <span class="string">"Expensive Therapy"</span></span><br><span class="line">    <span class="keyword">Then</span> I should see <span class="string">"Your article was published."</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">Scenario</span>: Dr. Bill tries to post to somebody else's blog, and fails</span><br><span class="line">    <span class="keyword">Given</span> I am logged in as Dr. Bill</span><br><span class="line">    <span class="keyword">When</span> I try to post to <span class="string">"Greg's anti-tax rants"</span></span><br><span class="line">    <span class="keyword">Then</span> I should see <span class="string">"Hey! That's not your blog!"</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">Scenario</span>: Greg posts to a client's blog</span><br><span class="line">    <span class="keyword">Given</span> I am logged in as Greg</span><br><span class="line">    <span class="keyword">When</span> I try to post to <span class="string">"Expensive Therapy"</span></span><br><span class="line">    <span class="keyword">Then</span> I should see <span class="string">"Your article was published."</span></span><br></pre></td></tr></table></figure>
<h2 id="数据表-data-table"><a href="#数据表-data-table" class="headerlink" title="数据表 (data table)"></a>数据表 (data table)</h2><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">|<span class="string"> start </span>|<span class="string"> eat </span>|<span class="string"> left </span>|</span><br><span class="line">|<span class="string">  12   </span>|<span class="string">  5  </span>|<span class="string">  7   </span>|</span><br><span class="line">|<span class="string">  20   </span>|<span class="string">  5  </span>|<span class="string">  15  </span>|</span><br></pre></td></tr></table></figure>
<p>数据表本质上是一个二维数组，是Gherkin的一个重要特性。<br>使用raw()方法可以获取原始格式，使用diff！可以比较数据表。</p>
<h2 id="场景轮廓-（Scenario-Outline）"><a href="#场景轮廓-（Scenario-Outline）" class="headerlink" title="场景轮廓 （Scenario Outline）"></a>场景轮廓 （Scenario Outline）</h2><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Scenario</span> <span class="keyword">Outline</span>: eating</span><br><span class="line">  <span class="keyword">Given</span> there are <span class="variable">&lt;start&gt;</span> cucumbers</span><br><span class="line">  <span class="keyword">When</span> I eat <span class="variable">&lt;eat&gt;</span> cucumbers</span><br><span class="line">  <span class="keyword">Then</span> I should have <span class="variable">&lt;left&gt;</span> cucumbers</span><br><span class="line"></span><br><span class="line">  <span class="keyword">Examples</span>:</span><br><span class="line">    |<span class="string"> start </span>|<span class="string"> eat </span>|<span class="string"> left </span>|</span><br><span class="line">    |<span class="string">  12   </span>|<span class="string">  5  </span>|<span class="string">  7   </span>|</span><br><span class="line">    |<span class="string">  20   </span>|<span class="string">  5  </span>|<span class="string">  15  </span>|</span><br></pre></td></tr></table></figure>
<p>场景轮廓用于遵循同样步骤的场景，使用它的前提是要有一个实例表（Examples，可以用Scenarios代替），通过它的占位符是尖括号 (&lt;..&gt;)，<br>将实例表的每一行转换成一个场景再执行。  </p>
<p>其中一个优点就是：你能够清楚地看到实例中遗漏的东西。<br>通过使用更大的占位符，可以有效地减少重复的内容。<br>但是这一切的底线是不能影响可读性，最终目的是为了能够解释自己。  </p>
<h2 id="嵌套步骤"><a href="#嵌套步骤" class="headerlink" title="嵌套步骤"></a>嵌套步骤</h2><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">When</span> /^I make all my stuff shiny$/</span><br><span class="line">  step <span class="string">"I polish my first thing"</span></span><br><span class="line">end</span><br><span class="line"></span><br><span class="line"><span class="keyword">When</span> /^I make all my stuff shiny$/</span><br><span class="line">  steps %&#123;</span><br><span class="line">    <span class="keyword">When</span> I polish my first thing</span><br><span class="line">    <span class="keyword">When</span> I shine my second thing</span><br><span class="line">  &#125;</span><br><span class="line">end</span><br></pre></td></tr></table></figure>
<p>通过steps %{}可以把一些步骤归纳成更抽象的步骤，但过度使用就会带来不必要的复杂性。</p>
<h2 id="文档字符串"><a href="#文档字符串" class="headerlink" title="文档字符串"></a>文档字符串</h2><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"""  </span></span><br><span class="line"><span class="string">many word ... together  </span></span><br><span class="line"><span class="string">"""</span></span><br></pre></td></tr></table></figure>
<p>1对的三个双引号”””之间，可以把一大堆文本(html/json/*)放置在内。  </p>
<h2 id="保持条理性"><a href="#保持条理性" class="headerlink" title="保持条理性"></a>保持条理性</h2><p>使用子文件夹和标签可以更有条理的管理特性，标签用@开头，可以通过命令行运行某个子文件夹或标签里的内容。</p>
<figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@billing</span></span><br><span class="line"><span class="keyword">Feature</span>: Verify billing</span><br><span class="line"></span><br><span class="line">  <span class="meta">@important</span></span><br><span class="line">  <span class="keyword">Scenario</span>: Missing product description</span><br><span class="line"></span><br><span class="line"><span class="keyword">Scenario</span>: Several products</span><br></pre></td></tr></table></figure>
<h1 id="常见问题及解决之道"><a href="#常见问题及解决之道" class="headerlink" title="常见问题及解决之道"></a>常见问题及解决之道</h1><h2 id="感受痛苦"><a href="#感受痛苦" class="headerlink" title="感受痛苦"></a>感受痛苦</h2><h3 id="闪烁的场景"><a href="#闪烁的场景" class="headerlink" title="闪烁的场景　"></a>闪烁的场景　</h3><pre><code>偶尔失败，随机失败的场景为闪烁的场景。  
</code></pre><p>解决它需要研究代码，弄清为什么会发生。<br>通常有以下问题所导致：</p>
<ul>
<li>共享的环境</li>
<li>渗露的场景</li>
<li>竞争条件和打瞌睡的步骤</li>
</ul>
<h3 id="脆弱的特性"><a href="#脆弱的特性" class="headerlink" title="脆弱的特性　"></a>脆弱的特性　</h3><pre><code>脆弱的特性极易被破坏。特性脆弱时，在测试套件或主代码库的某个部分做些必要的修改会破坏明显不相关的场景。
</code></pre><p>脆弱的特性通常由以下问题之一所引发。</p>
<ul>
<li>固件数据</li>
<li>重复</li>
<li>渗露的场景</li>
<li>被隔离的测试人员</li>
</ul>
<h3 id="缓慢的特性"><a href="#缓慢的特性" class="headerlink" title="缓慢的特性"></a>缓慢的特性</h3><p>缓慢的特性通常由下列问题的某种组合引发。</p>
<ul>
<li>竞争条件和打瞌睡的步骤</li>
<li>大量场景              </li>
<li>大泥球                </li>
</ul>
<h3 id="厌倦的利益相关人"><a href="#厌倦的利益相关人" class="headerlink" title="厌倦的利益相关人"></a>厌倦的利益相关人</h3><p>一开始就同业务利益相关人建立正确的协作关系。如果他们觉得自己太忙，没时间帮你准确理解他们想要的东西，那么你面对的是一个更深层的团队问题，Cucumber爱莫能助。</p>
<p>但另一方面，许多团队开始时倒是有热心主动的利益相关人，可团队却浪费了Cucumber带来的建立这种协作关系的机会。如果测试人员或开发人员独自编写特性，他们就难免使用技术术语，这样利益相关人在阅读的时候会觉得自己被边缘化了。</p>
<p>这会变成恶性循环：利益相关人本来可以帮助你使用对他们有意义的语言编写特性，但随着兴趣渐失，他们花在这上面的时间会越来越少。不知不觉中，特性就沦为纯粹的测试工具了。</p>
<p>这一痛苦症状通常由下列问题的某种组合引发。</p>
<ul>
<li>偶然细节        </li>
<li>命令式步骤      </li>
<li>重复            </li>
<li>语言不通用      </li>
<li>闭门造车式的特性</li>
</ul>
<h2 id="同心协力"><a href="#同心协力" class="headerlink" title="同心协力"></a>同心协力</h2><p>Cucumber的特性正是Gojko Adzic 所说的活文档（living documentation）。这一术语恰如其分地总结了使用Cucumber的两大好处。</p>
<p>活的：能自动测试系统，以便你可以安全地工作。</p>
<p>文档：便于大家有效地沟通系统的当前行为和预期行为。</p>
<h3 id="偶然细节"><a href="#偶然细节" class="headerlink" title="偶然细节"></a>偶然细节</h3><pre><code>像密码这种在场景中提及但实际上与场景的目标毫无关系的细节，我们称之为偶然细节（incidental detail） 。这种不相关的细节使得场景很难阅读，而这又会让利益相关人对阅读场景失去兴趣。
</code></pre><p><em>避免偶然细节</em></p>
<p>编写场景的时候，尽力避免被已有的步骤定义所左右，只管用直白的语言把你希望发生的事情确切地写下来即可。</p>
<p>事实上，尽量不要让程序员或测试人员独自编写场景。让非技术的利益相关人或者分析师从纯粹以业务为中心的角度出发编写每个场景的初稿，或者最理想的情况是与程序员结对，从而分享他们的构思模型。</p>
<p>有了工程意义上设计精良的支持层，你便可以信心百倍地快速编写新的步骤定义来配合场景的表达方式。</p>
<h3 id="命令式步骤"><a href="#命令式步骤" class="headerlink" title="命令式步骤"></a>命令式步骤</h3><pre><code>命令式编程是指使用一个命令序列，让计算机按特定的次序执行它们。
</code></pre><p>Ruby就是命令式语言的例子：你把程序写成一系列的语句，Ruby按顺序每次执行其中的一条语句。</p>
<pre><code>声明式编程则告诉计算机应该做什么（what），而并不精确指明如何（how）去做。
</code></pre><p>CSS就是声明式语言的例子：你告诉计算机希望Web页面上的各种元素如何呈现，剩下的让计算机去处理。</p>
<p>Gherkin当然是命令式语言。Cucumber按照你编写的顺序依次执行场景中的每个步骤，每次执行一步。但这并不意味着这些指令读起来要像装配组合家具的说明书一样。</p>
<p>最严重的是，使用这样的泛化步骤定义写出的场景无法创建出场景的领域语言。</p>
<p>Gherkin特性中在命令式风格和声明式风格之间并没有明确的界线。</p>
<p>相反，这是一个连续的频谱，每个场景中每个步骤在频谱上的正确位置取决于许多方面：你所描述的系统领域，你所构建的应用类型，程序员的领域知识，以及非技术利益相关人对程序员的信任水平。</p>
<p>如果利益相关人希望在特性中看到许多细节，这或许表明你需要努力改善这一信任，但也可能说明你们开发的系统就是需要详述很多细 节的。</p>
<h3 id="重复"><a href="#重复" class="headerlink" title="重复"></a>重复</h3><pre><code>DRY原则 （Don&apos;t Repeat Yourself）指出，任何概念的定义应当在代码中出现且仅出现一次。
</code></pre><p>这是一个了不起的目标，因为你如果必须对系统的行为做出修改，肯定希望只在一个地方修改，同时又对改动很有信心，相信它会一致地应用于整个代码库。如果那种行为散落在代码的多处定义中，不但你自己无法全部找到它们，很可能在你之前因为别人也不能全部找到，结果那些定义已经彼此不一致了，谁愿意这样呢？</p>
<p>然而，在你用实例驱动代码的时候，我相信有另外一个原则优于DRY：实例应当讲出一个好故事。实例是给未来的程序员（包括你自己，如果在3个月以后你会回来修改这段代码的话，那时你已经忘记它做的是什么了）提供指导的文档叙述。</p>
<p>假设你读这样一本书：里面所有的情节和人物都按照DRY原则给抽干了，一切只出现在脚注或附录中。所有的人物描述、情节元素、潜台词等都被仔细抽取出来，做成交叉引用的章节。如果你是在读百科全书，这非常好，但如果你想投入到故事流中，弄清楚发生的事情，这样就不太合适了。你会在书中无休止地来回翻阅，而且很快会忘记故事看到哪儿了。借用一个古老的玩笑，字典里面密密麻麻全是情节，但在”情节”的行进中，它们至少解释了所有的单词。</p>
<pre><code>有些人把这称为DAMP（Descriptive and Meaningful Phrases）原则：描述性且有意义的叙述。编写实例的时候，可读性压倒一切，于是DAMP高于DRY。
</code></pre><h3 id="语言不通用"><a href="#语言不通用" class="headerlink" title="语言不通用"></a>语言不通用</h3><p>我们讨论的是开发一种通用语言，因为这是一个持续进行的过程。这一开发过程需要我们工作上的投入。真正做到彼此倾听并且就使用的词语达成一致是需要努力的，而坚持这种约定也是需要纪律的。</p>
<p>然而，回报是巨大的。使用通用语言的团队犯错更少，且更能享受工作的乐趣，因为他们能有效地沟通工作内容。</p>
<p>不重视通用语言价值的团队将会粗枝大叶地使用场景中的语汇，从而丧失在团队中专注技术和专注业务的双方之间构筑坚固桥梁的宝贵机会。那时，如果你试图纠正别人或澄清术语，带给人的感觉只会是吹毛求疵。</p>
<h3 id="闭门造车式的特性"><a href="#闭门造车式的特性" class="headerlink" title="闭门造车式的特性"></a>闭门造车式的特性</h3><p>人们会觉得Cucumber是一种技术性较强的工具。它从命令行运行，特性文件也被设计成需要与被测代码一道签入版本控制系统。然而它却以帮助提高团队的业务利益相关人对开发过程的控制感为目标。当测试和开发尽情把特性塞入版本控制的时候，团队中其他人会觉得他们的文档被锁进了柜子，而他们却没有钥匙。</p>
<p>你只需要坚持做到同业务利益相关人一起坐下来协作编写场景，就足以收获Cucumber至少一半的好处。这一过程所激发的交谈会解开太多太多的潜在bug或时间延误，即便你从不打算将特性自动化，也已经收获颇丰了。</p>
<h2 id="照管好你的测试"><a href="#照管好你的测试" class="headerlink" title="照管好你的测试"></a>照管好你的测试</h2><p>自动化特性的好处在于你可以把它们作为活文档来长期信赖，因为你会将每一个场景都用于检查产品代码，以确保它们仍然有效。</p>
<p>对于同代码打交道的程序员来说，这还有另一件好处：在他们开发系统的时候，那些测试可以充当安全网，对任何破坏已有行为的错误都给出警告。</p>
<h3 id="渗露的场景"><a href="#渗露的场景" class="headerlink" title="渗露的场景"></a>渗露的场景</h3><pre><code>Cucumber场景本质来说是状态转换，如果2个测试之间存在状态依赖，那就发生了渗露（leak）
</code></pre><p>每个场景都是独立的，可以确保场景将系统置于干净的状态，然后再添加自己的数据。</p>
<h3 id="竞争条件和打瞌睡的步骤"><a href="#竞争条件和打瞌睡的步骤" class="headerlink" title="竞争条件和打瞌睡的步骤"></a>竞争条件和打瞌睡的步骤</h3><p>端对端的测试里，终究会遇到竞争条件和沉睡的步骤的问题。</p>
<p>一种粗糙的解决方法就是引进固定时长地停顿或睡眠。</p>
<p>如果一定要作出选择，我们宁可要缓慢但可靠的测试，也不要更快但不可靠的测试。</p>
<p>但如果熟知系统工作原理，就可以利用系统隐含的线索让测试知道何时能够安全地前进。</p>
<h3 id="共享的环境"><a href="#共享的环境" class="headerlink" title="共享的环境"></a>共享的环境</h3><p>对单一环境的共享使用会对数据库这种紧张地资源造成沉重且不稳定的负荷，从而造就不可靠的测试。</p>
<p>解决之道在于“一键式搭建系统”</p>
<h3 id="被隔离的测试人员"><a href="#被隔离的测试人员" class="headerlink" title="被隔离的测试人员"></a>被隔离的测试人员</h3><p>测试人员不应该被看作二等公民，应该与开发人员结对，创造结构更清晰，更稳健的测试套件。</p>
<p>这样测试人员就可以解放自己，去做更有趣、更有创造性的探索性测试。（exploratory testing）</p>
<h3 id="固件数据-（fixture-data）"><a href="#固件数据-（fixture-data）" class="headerlink" title="固件数据 （fixture data）"></a>固件数据 （fixture data）</h3><p>固件数据，即使开始时相对精简，时间长了体积也会只增不减。随着越来越多的场景开始依赖这些数据，且每个场景都要对它们做一点特别的处理，固件数据的体积会越来越大，复杂度也会越来越高。</p>
<p>当你为了某个场景对数据做点改动，结果却使其他场景失败时，你将开始感受到脆弱的特性的痛苦。</p>
<p>有这么多不同的场景依赖于固件数据，你会倾向于糊上更多的数据，因为这比修改已有的数据更加安全。某个场景失败时，你很难清楚系统中的哪一团数据可能跟失败相关，诊断起来也更加困难。</p>
<p>我们认为固件数据是一种反模式（antipattern）。</p>
<p>我们更倾向于使用之前介绍过的测试数据构造器，比如FactoryGirl ，那样可以让测试本身从内部创建相关数据，而不是让这些数据淹没在一大团混乱的固件数据集合中。</p>
<h3 id="大量场景"><a href="#大量场景" class="headerlink" title="大量场景"></a>大量场景</h3><p>数量巨大的特性很难组织得井井有条，可通过子文件夹和标签来合理组织。</p>
<p>另外一种方法就是考虑下移一些到单元测试里。</p>
<h3 id="大泥球"><a href="#大泥球" class="headerlink" title="大泥球"></a>大泥球</h3><p>软件架构一团糟得情况叫做大泥球（Big Ball of Mud）。</p>
<p>Alistair Cockurn的<a href="http://antinomy.github.io/art/2014/11/20/HexArchitecture.html" target="_blank" rel="noopener">端口和适配器（port and adapter）</a>架构是一种让系统容易测试的架构，建议使用.</p>
<h1 id="勾勒出领域模型"><a href="#勾勒出领域模型" class="headerlink" title="勾勒出领域模型"></a>勾勒出领域模型</h1><pre><code>任何面向对象程序的核心都是领域模型。
</code></pre><p>基于领域模型工作，而不是用户界面上的各种花样。</p>
<p>一旦有了能够反映我们对系统理解的领域模型，给它包上漂亮的外衣是很容易的事情。</p>
<h2 id="准确用词"><a href="#准确用词" class="headerlink" title="准确用词"></a>准确用词</h2><h2 id="实话实说"><a href="#实话实说" class="headerlink" title="实话实说"></a>实话实说</h2><h2 id="做最简单的事情"><a href="#做最简单的事情" class="headerlink" title="做最简单的事情"></a>做最简单的事情</h2>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/04/06/Tech-2015-2015-07-15-Cucumber-BDD/" data-id="cjf9gd8b8003cvzznolow9cto" class="article-share-link">Teilen</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="mobile-Art-2015-2015-11-24-buildingMicroService" class="article article-type-mobile" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/11/23/Art-2015-2015-11-24-buildingMicroService/" class="article-date">
  <time datetime="2015-11-23T03:17:01.000Z" itemprop="datePublished">2015-11-23</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Tao/">Tao</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/11/23/Art-2015-2015-11-24-buildingMicroService/">Building MicroService</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="构建微服务"><a href="#构建微服务" class="headerlink" title="构建微服务"></a>构建微服务</h1><p><img src="http://ec4.images-amazon.com/images/I/51gi3fUMdzL._SX379_BO1,204,203,200_.jpg" alt="img">  </p>
<p>微服务向来是我个人更倾向的一种架构风格，它具有更加开放的技术姿态。<br>通过阅读这本《Building MicroService》，让我对微服务有了更深入的了解，同时也发现了它与DDD、CD是完美契合的。  </p>
<h1 id="康威定律"><a href="#康威定律" class="headerlink" title="康威定律"></a>康威定律</h1><pre><code>任何设计系统的组织，最终产生的设计等同于组织之内、之间的沟通结构。系统架构的设计符合组织沟通结构取得的收益最大。
</code></pre><p>组织的架构最终决定系统的架构，如果你存在一个等级森严、层层架构的组织，那么，微服务就不一定适合你的组织。</p>
<h1 id="什么是微服务？"><a href="#什么是微服务？" class="headerlink" title="什么是微服务？"></a>什么是微服务？</h1><pre><code>这个世界上既不存在银弹，也不会有免费的午餐。
</code></pre><p>微服务作为一个新兴的分布式系统架构，它解决了如何实现低耦合、高内聚的问题，同时也带来了很多分布系统特有的复杂性。</p>
<pre><code>微服务是指：一些小而独立的服务联合起来一起工作。
</code></pre><p><em>那么，多小算小？</em></p>
<p>给一个具体的代码行数是不靠谱的，不同的语言实现同样的功能，所需要的行数也是不同。<br>一般来说，一个team花2周的时间就能实现的功能大小比较合适。</p>
<h2 id="好处"><a href="#好处" class="headerlink" title="好处"></a>好处</h2><ul>
<li>技术多样性</li>
<li>容灾性</li>
<li>伸缩性</li>
<li>容易部署</li>
<li>与组织结构对应</li>
<li>组合性</li>
<li>可替换性</li>
</ul>
<h2 id="挑战"><a href="#挑战" class="headerlink" title="挑战"></a>挑战</h2><ul>
<li>切分</li>
<li>部署</li>
<li>监控</li>
<li>安全</li>
<li>集成</li>
</ul>
<p><img src="/img/2015/mircoService_1.png" alt="img"><br>（使用不同的技术栈来构建微服务）  </p>
<h2 id="MicroService-vs-SOA"><a href="#MicroService-vs-SOA" class="headerlink" title="MicroService vs SOA"></a>MicroService vs SOA</h2><p>微服务是一种特殊的SOA实现方式，就像XP ／ Scrum是敏捷开发的一种实现方式。</p>
<h1 id="进化的架构"><a href="#进化的架构" class="headerlink" title="进化的架构"></a>进化的架构</h1><p>构建微服务的过程中，架构师的角色更像是一个城市规划师，而不是一栋建筑的设计师。<br>架构师需要制定对应的：战略目标、规则、以及实践方式。  有统一标准的监控、接口实现方式和安全措施。  </p>
<h1 id="集成"><a href="#集成" class="headerlink" title="集成"></a>集成</h1><h2 id="服务集成"><a href="#服务集成" class="headerlink" title="服务集成"></a>服务集成</h2><p>理想的集成技术应该是：</p>
<ul>
<li>避免破坏性的改变  </li>
<li>保持API的技术无限性  </li>
<li>让消费者简单使用服务  </li>
<li>隐藏实现细节  </li>
</ul>
<h2 id="共享数据库"><a href="#共享数据库" class="headerlink" title="共享数据库"></a>共享数据库</h2><p>共享数据库的方式让数据更容易去共享，但对行为的共享没有任何帮助。</p>
<h2 id="同步-vs-异步"><a href="#同步-vs-异步" class="headerlink" title="同步 vs 异步"></a>同步 vs 异步</h2><p>同步没什么好说的。 ：）</p>
<p>异步的交流方式有2种 ：<br>request/response 或者 event-based</p>
<p><em>request/response</em>： 一问一答的方式比较传统，也可用于同步的方式。</p>
<p><em>event-based</em>： 事件驱动,这种方式是基于事物状态的变化，能够高度的解耦。</p>
<h2 id="RPC-（Remote-Procedure-Calls）"><a href="#RPC-（Remote-Procedure-Calls）" class="headerlink" title="RPC （Remote Procedure Calls）"></a>RPC （Remote Procedure Calls）</h2><p>RPC的技术能让本地环境方便去调用外部接口，同时也具有较高的性能。</p>
<p>但是它也存在一些特有的问题：</p>
<ul>
<li>技术耦合</li>
<li>本地调用不等于远程调用</li>
<li>易脆</li>
</ul>
<p>一些RPC的机制，例如Java RMI，会严重地去依赖某个特定的平台，限制服务器和客户端所使用的技术。  </p>
<p>RPC的核心理念是隐藏远程调用的复杂性，但是往往隐藏的过多，本地调用并不等于远程调用。  </p>
<p><em>分布式系统的第一谬误， “网络是稳定的”。</em>  </p>
<p>任何RPC机制的最大问题在于，无法分开部署客户端和服务器端。<br>如果你使用这项技术，未来的更新步骤是锁步的。  </p>
<h2 id="REST"><a href="#REST" class="headerlink" title="REST"></a>REST</h2><p>REST是基于HTTP本身特性的架构风格，它有三种成熟度模型，详情请查看 <a href="http://antinomy.github.io/art/2015/07/03/RichardsonMaturityModel.html" target="_blank" rel="noopener">Richardson Restful成熟度模型</a></p>
<h2 id="DRY"><a href="#DRY" class="headerlink" title="DRY"></a>DRY</h2><p>DRY原则更多的是：关于避免重复系统的行为和知识，而不是单单代码层面的重复。</p>
<h1 id="实践原则"><a href="#实践原则" class="headerlink" title="实践原则"></a>实践原则</h1><p><img src="/img/2015/mircoService_2.png" alt="img">  </p>
<h2 id="围绕业务内容建模"><a href="#围绕业务内容建模" class="headerlink" title="围绕业务内容建模"></a>围绕业务内容建模</h2><p>多年来的工作经验告诉我们：基于业务边界划分的结构，要远比基于技术内容划分的结构稳定。</p>
<p>《领域驱动设计》里面的限界上下文是一个很棒的出发点， 它提供了一个从业务的角度去划分模块的方式。 </p>
<h2 id="拥抱自动化的文化"><a href="#拥抱自动化的文化" class="headerlink" title="拥抱自动化的文化"></a>拥抱自动化的文化</h2><p>微服务带来了很多复杂性，克服这些困难的关键是要拥抱自动化开发的文化，如自动化测试，持续交付等等实践。</p>
<h2 id="隐藏实现细节"><a href="#隐藏实现细节" class="headerlink" title="隐藏实现细节"></a>隐藏实现细节</h2><p>采取无限技术的方式，例如REST，能够让你更自由地使用不同的技术栈。<br>尽量隐藏实现的细节，服务的消费者不需要知道服务是用什么语言实现，是用什么样的数据库。  </p>
<h2 id="去中心化所有东西"><a href="#去中心化所有东西" class="headerlink" title="去中心化所有东西"></a>去中心化所有东西</h2><p>为了让每一个微服务尽可能的独立，去中心化所有的东西能够避免把所有的鸡蛋都放在一起。</p>
<h2 id="独立部署"><a href="#独立部署" class="headerlink" title="独立部署"></a>独立部署</h2><p>通过蓝绿或者金丝雀部署方式，可以降低部署的风险。<br>采用消费者驱动契约的方式能够尽早的发现问题。</p>
<h2 id="隔离失败"><a href="#隔离失败" class="headerlink" title="隔离失败"></a>隔离失败</h2><p>理解和计划失败是分布式系统的一部分，通过Bulkheads或者Circuit breakers模式能够有效的控制失败带来的影响。</p>
<h2 id="高度可视化"><a href="#高度可视化" class="headerlink" title="高度可视化"></a>高度可视化</h2><p>聚合所有的日志和状态，通过语义监控来观察系统是否正常。 使用correlation IDs可以方便地跟踪系统调用的痕迹。</p>
<h1 id="分布式领域CAP理论"><a href="#分布式领域CAP理论" class="headerlink" title="分布式领域CAP理论"></a>分布式领域CAP理论</h1><p><img src="/img/2015/mircoService_3.png" alt="img">  </p>
<p>Consistency(一致性),  数据一性<br>Availability(可用性), 好的响应性能<br>Partition tolerance(分区容错性) 可靠性  </p>
<p>定理：任何分布式系统只可同时满足二点，没法三者兼顾。<br>CA不属于分布式系统，所以只考虑AP和CP。<br>AP要比CP容易实现，具体用哪一种要看具体业务。  </p>
<h1 id="End"><a href="#End" class="headerlink" title="End"></a>End</h1><p>这么多年来，我们不断地找到更好的方式去开发系统：<br>Eric Evans‘s 《领域驱动设计》 帮助我们去了解让代码去呈现真实世界的重要性。<br>《持续交付》告诉我们如何更加有效率的发布软件到生产环境。<br>Alistair Cockburn的 <a href="http://antinomy.github.io/art/2014/11/20/HexArchitecture.html" target="_blank" rel="noopener">六边形架构</a> 告诉我们如何避免把业务逻辑四分五裂的隐藏在各层的架构上。<br>各种虚拟化平台，如Amazon云、阿里云，允许我们去定制自己所需要的机器。<br>最近，Netflix公司跟我们分享来一种 <a href="http://www.infoq.com/cn/news/2015/11/ScaleScale-MaxCDN-NetFlix" target="_blank" rel="noopener">高扩展性的架构风格</a> ，<br>既微服务架构，这种架构在十年前很难实现，幸运地是，今时不同往日。 ：）</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2015/11/23/Art-2015-2015-11-24-buildingMicroService/" data-id="cjf9gd89b001uvzznmj7c9ds0" class="article-share-link">Teilen</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="mobile-Other-2015-2015-08-20-SpeakLikeTED" class="article article-type-mobile" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/08/20/Other-2015-2015-08-20-SpeakLikeTED/" class="article-date">
  <time datetime="2015-08-20T07:29:11.000Z" itemprop="datePublished">2015-08-20</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Other/">Other</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/08/20/Other-2015-2015-08-20-SpeakLikeTED/">Speak like TED</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="像TED一样演讲"><a href="#像TED一样演讲" class="headerlink" title="像TED一样演讲"></a>像TED一样演讲</h1><p><img src="http://img3.douban.com/lpic/s27999310.jpg" alt="img">  </p>
<p>《像TED一样演讲》是属于提升软技能技巧的书，遵循其中的技巧能让你的演讲别具一格。  </p>
<pre><code>一个让人难忘的演讲，是有情感的，让你感到新奇和难忘的。
</code></pre><p>#情感</p>
<pre><code>有情感的演讲，是有热情的，融入一个故事里的，又像跟好友交谈一样自然。
</code></pre><p>##热情<br>热情将帮助你最大限度地施展自己的才能。  </p>
<p>有热情的故事是有感染力的，要感染别人，先要感染自己，让自己的心灵歌唱。  </p>
<p>一切都源自于你的动机，如果你的动机是分享你的热情，那很可能就不会那么紧张。  </p>
<p>要成就伟业，就需要热爱自己的工作。获得真正的满足感。  </p>
<p>热情是自我认同的核心，人们无法把他们的追求和他们自身分开，热情是他们存在的核心。  </p>
<p>演讲越多，脑部结构变化越大，脑部的语言区域也越发达。  </p>
<p>你的热情可以感染观众和员工，给追随者带来积极的情感体验。<br>热情是一种领袖气质，能够引起观众的共鸣。  </p>
<p>##故事<br>    故事是有灵魂的数据</p>
<p>通过故事，能把思想和情感植入观众的大脑，推倒人与人之间的一堵墙。  </p>
<p>故事能给我一个我想要支持的人物，提高在商场中的竟争力。  </p>
<p>简单却有效的三类故事：  </p>
<ul>
<li>个人故事</li>
<li>其他人的故事</li>
<li>产品／品牌的成败的故事</li>
</ul>
<p>故事是有说服力的，说服力的三个要素是：  </p>
<ul>
<li>喻德</li>
<li>喻理</li>
<li>喻情</li>
</ul>
<p>##自然<br>    确保非语言表达－－手势、表情和肢体语言，与语言协调</p>
<h3 id="完善演讲"><a href="#完善演讲" class="headerlink" title="完善演讲"></a>完善演讲</h3><ul>
<li>征求他人意见</li>
<li>早期反馈</li>
<li>练习、练习、还是练习            </li>
</ul>
<h3 id="语言表达"><a href="#语言表达" class="headerlink" title="语言表达"></a>语言表达</h3><ul>
<li>语速<br>（每分钟150～160个单词）</li>
<li>音量</li>
<li>声调</li>
<li>停顿</li>
</ul>
<h3 id="肢体语言"><a href="#肢体语言" class="headerlink" title="肢体语言"></a>肢体语言</h3><pre><code>像领导者一样讲话、走路和着装
</code></pre><h4 id="手势能让有力的观点更加有力"><a href="#手势能让有力的观点更加有力" class="headerlink" title="手势能让有力的观点更加有力"></a>手势能让有力的观点更加有力</h4><p>关键时刻使用，上不高眼睛、下不低肚脐 、 左右不超过双臂伸展、后不过眼睛。</p>
<h3 id="纠正小动作"><a href="#纠正小动作" class="headerlink" title="纠正小动作"></a>纠正小动作</h3><p>纠正某些烦人的小动作如：坐立不安，原地不动，手插口袋等。<br>有目的地做动作，不要一直站在观众面前。<br>不要手插口袋，把手拿出来做手势，假装自信直到自信满满。  </p>
<p>#新奇</p>
<h2 id="新视角"><a href="#新视角" class="headerlink" title="新视角"></a>新视角</h2><h3 id="大脑喜欢新奇"><a href="#大脑喜欢新奇" class="headerlink" title="大脑喜欢新奇"></a>大脑喜欢新奇</h3><p><em>给人们一个看世界的新视角</em></p>
<p>人是天生的探险,我们都是探险“瘾君子”。<br>换个视角看世界,探索你未知的领域  </p>
<p>学习是一种快乐，快乐的时候大脑会产生多巴胺。多巴胺能够帮助记忆，是大脑中天然的“保存按钮”。  </p>
<h2 id="惊奇"><a href="#惊奇" class="headerlink" title="惊奇"></a>惊奇</h2><h3 id="别用你惯用的手段糊弄群众"><a href="#别用你惯用的手段糊弄群众" class="headerlink" title="别用你惯用的手段糊弄群众"></a>别用你惯用的手段糊弄群众</h3><p>设计让观众惊掉下巴的环节，调动多种感官——视觉、触觉、感觉来讲故事。<br>抽象的信息需要具体的解释，如果观众无法理解你的信息，你就无法让他们“惊掉下巴”。  </p>
<h2 id="幽默"><a href="#幽默" class="headerlink" title="幽默"></a>幽默</h2><p>别把自己看得太严肃。大脑喜欢幽默，你可以说下让群众发笑的话。但前提是你必须学会创造性，自然地把幽默融入你的演讲。  </p>
<p>幽默是一种“取悦策略”，让人更容易被接纳。  </p>
<p><em>5种制造幽默的方式</em>：</p>
<ul>
<li>趣闻、见解和个人故事</li>
<li>类比和比喻</li>
<li>引用</li>
<li>视频</li>
<li>照片</li>
</ul>
<p>#难忘<br>    你必须勇敢地表达自己的直觉和思想，不然那些本可以让人铭记的东西也会消失不见。</p>
<h2 id="时间规则"><a href="#时间规则" class="headerlink" title="时间规则"></a>时间规则</h2><p>演讲时间越长，听众越焦虑。<br>思考是个苦差事，听是一项让人疲惫不堪的活动。  </p>
<p>听者会不断给大脑添加需要记忆和提取的信息，这就是“认知积压”。  </p>
<p>一个乏味且漫长的演讲让听众的大脑不断地消耗能量，即大脑内大量的葡萄糖，<br>而时长18分钟的演讲不会。  </p>
<pre><code>有约束才能激发创造力
</code></pre><p>对一个复杂的问题，如果演讲者能给出简单的解释，观众就会相信他精通这一学科。</p>
<pre><code>如果你不能用简单的话把问题解释清楚，说明你还没有真正理解这个问题。 ——爱因斯坦
</code></pre><p>###“三”的法则</p>
<pre><code>简单是终极的复杂，事不过三。
</code></pre><p>人脑的短时记忆或工作记忆只能同时记住三个信息片段。</p>
<h2 id="多感官体验"><a href="#多感官体验" class="headerlink" title="多感官体验"></a>多感官体验</h2><pre><code>解释某个想法时，图文并茂好过单纯的文字。
</code></pre><p>抓住观众吸引力的魔法是： 多感官体验  </p>
<p>优秀的演讲通常以调动观众的某一个感官为主，同时也会刺激观众的至少一种其他感官：视觉、听觉、触觉、嗅觉和味觉。</p>
<ul>
<li>视觉技巧： 多图，少字</li>
<li>听觉技巧： 用语言绘制一幅画</li>
<li>触觉技巧： 让观众“感同身受”</li>
</ul>
<h2 id="真实"><a href="#真实" class="headerlink" title="真实"></a>真实</h2><pre><code>表现最真实的自己
</code></pre><p><img src="/img/2015/SpeakLikeTED.png" alt="img"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2015/08/20/Other-2015-2015-08-20-SpeakLikeTED/" data-id="cjf9gd89p0023vzzndzjfl201" class="article-share-link">Teilen</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="mobile-Art-2015-2015-08-03-TheArtOfUnitTesting" class="article article-type-mobile" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/08/03/Art-2015-2015-08-03-TheArtOfUnitTesting/" class="article-date">
  <time datetime="2015-08-03T09:06:12.000Z" itemprop="datePublished">2015-08-03</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Art/">Art</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/08/03/Art-2015-2015-08-03-TheArtOfUnitTesting/">The Art of Unit Testing</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="单元测试的艺术"><a href="#单元测试的艺术" class="headerlink" title="单元测试的艺术"></a>单元测试的艺术</h1><p><img src="http://img3.douban.com/lpic/s27346585.jpg" alt="img">  </p>
<pre><code>所有程序员都知道应该做单元测试！
</code></pre><p>然而很多人却没有做，原因是各式各样的。<br>就如Uncle Bob之前提到过的 <a href="http://antinomy.github.io/art/2014/10/14/TheLittleMocker.html" target="_blank" rel="noopener">The Little Mocker</a> 中介绍Mock和Stub的关系一样, 这本书对一些容易混淆的概念作出了解释，也解释了实现的单元测试的难度和好处。</p>
<h1 id="优秀单元测试的特质"><a href="#优秀单元测试的特质" class="headerlink" title="优秀单元测试的特质"></a>优秀单元测试的特质</h1><ul>
<li>自动化的代码</li>
<li>用自动化测试框架编写</li>
<li>容易编写</li>
<li>运行快速</li>
<li>能由开发团队里的任何人重复运行</li>
</ul>
<h2 id="三大支柱"><a href="#三大支柱" class="headerlink" title="三大支柱"></a>三大支柱</h2><ul>
<li>可读性</li>
<li>可维护性</li>
<li>可靠性</li>
</ul>
<p>用TDD的开发方式比较容易实现优秀的单元测试。  </p>
<h1 id="测试命名的规范"><a href="#测试命名的规范" class="headerlink" title="测试命名的规范"></a>测试命名的规范</h1><pre><code>[UnitOfWork]_[Scenario]_[ExpectedBehavior]
</code></pre><p>尽量不用［Setup］/ @Before 和 ［Teardown］/ @After ,用工厂方法代替。</p>
<h1 id="用存根（Stub）破除依赖"><a href="#用存根（Stub）破除依赖" class="headerlink" title="用存根（Stub）破除依赖"></a>用存根（Stub）破除依赖</h1><p>找到或者创造合适的中间层，在运行代码中注入存根。</p>
<h1 id="存根（Stub）-vs-模拟对象（Mock）"><a href="#存根（Stub）-vs-模拟对象（Mock）" class="headerlink" title="存根（Stub） vs 模拟对象（Mock）"></a>存根（Stub） vs 模拟对象（Mock）</h1><p>存根不会让测试失败，不会在里面写断言，仅仅用来模拟各种场景。  </p>
<p>模拟对象类似存根，但它能进行断言。 一个测试不能有多个模拟对象，它之外的伪对象都应该是存根。</p>
<h1 id="隔离框架"><a href="#隔离框架" class="headerlink" title="隔离框架"></a>隔离框架</h1><p>隔离框架很酷，关键在于如何自如地使用它们。  </p>
<p>如果超过5%的测试使用模拟对象（而非存根），那就可能“过度指定”了，会导致代码既不可读，又容易失败。   </p>
<p>隔离框架分2种：</p>
<ul>
<li>受限</li>
<li>不受限</li>
</ul>
<p>选择框架时要理解一个框架的能力和局限，大多数的受限框架在运行时生成和编译代码。</p>
<h1 id="测试层次和组织"><a href="#测试层次和组织" class="headerlink" title="测试层次和组织"></a>测试层次和组织</h1><ul>
<li>无论何种测试，都应该自动化</li>
<li>把集成测试和单元测试分开<br>（慢和快测试分开，创造绿色安全区）</li>
<li>按项目和类型组织测试</li>
<li>使用测试类层次</li>
<li>把API介绍给队友</li>
</ul>
<h1 id="在组织中引入单元测试"><a href="#在组织中引入单元测试" class="headerlink" title="在组织中引入单元测试"></a>在组织中引入单元测试</h1><p>不要疏远可能帮助自己的人，准备好进行一场艰难的战斗： 理解影响力的力量。</p>
<h1 id="遗留代码"><a href="#遗留代码" class="headerlink" title="遗留代码"></a>遗留代码</h1><p>要了解各个组件的依赖数、逻辑量以及在项目中的优先级，从简单的开始。  </p>
<p>处理遗留代码的时候，带上一瓶好伏特加也是个不错的主意。 （=_=）  </p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2015/08/03/Art-2015-2015-08-03-TheArtOfUnitTesting/" data-id="cjf9gd897001svzzn14yyn89m" class="article-share-link">Teilen</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="mobile-Tao-2015-2015-05-01-theFearOfDeath" class="article article-type-mobile" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/07/15/Tao-2015-2015-05-01-theFearOfDeath/" class="article-date">
  <time datetime="2015-07-15T07:46:54.000Z" itemprop="datePublished">2015-07-15</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Tao/">Tao</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/07/15/Tao-2015-2015-05-01-theFearOfDeath/">The Fear of Death</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="死亡的恐惧"><a href="#死亡的恐惧" class="headerlink" title="死亡的恐惧 "></a>死亡的恐惧 </h1><p><img src="/img/2015/deathFear1.png" alt="img"></p>
<p>最近有个朋友问我，要如何才能面对死亡的恐惧。  </p>
<p>好吧，其实这个问题，从我懂事以来就常在思考。<br>当你意识到，人出生的时候就注定了死亡，自己也会死的时候，会不会觉得整个世界都不会好了呢？  </p>
<pre><code>那么，自古以来，人们都怎么克服对死亡对恐惧，而微笑地活下去地呢？
</code></pre><p>我能想到的，无非是以下几种：  </p>
<p>#遗忘<br>遗忘大概是最多人采取的策略。<br>在日常时候生活里，意识会假装死亡并不存在，从而无惧地生活下去。  </p>
<p>#宗教<br>如果经历过身边的人的死亡，那么遗忘策略可能就不那么奏效了。<br>这个时候，宗教就出现了。<br>在多数的宗教里，死亡并不是终点，而是试炼的一部分。<br>有些宗教通过复活来解决，有些宗教通过轮回来解决，有些则通过创造来天堂和地狱来分流不同的羔羊。<br>宗教的好处是你可以不用思考，只要怀着虔诚地追寻：  </p>
<pre><code>一位先知，一个预言，一部经书，一个启示。
</code></pre><p>#哲学<br>当然也有一些不相信宗教的人，那么，他们该如何来克服自己对死亡的恐惧呢？<br>答案是构筑一个自己可以信服的理论来接受死亡，我们通常称之为哲学。  </p>
<pre><code>学哲学就是为了学死。
</code></pre><p>我在某本哲学书里看到的，关于哲学和死亡，最为印象深刻的一句话。<br>哲学的流派也分好多，唯心的，唯物的，辩证的，等等，我就不一一介绍了。  </p>
<p>#忙碌<br>以上几种都算比较积极的方法。<br>接下来就是较为消极的方法了：  </p>
<p>有些人选择让自己一直处于忙碌的状态，这样就没空去想这个问题。  </p>
<pre><code>仿佛一只把头埋在沙里的鸵鸟，外面发生的事情，与我无关。  
</code></pre><p>#拥抱<br>最为消极的方法，莫过于直接地去拥抱死亡了。<br>无法逃避，无法接受，最终只能选择自杀了。  </p>
<p>#结论<br>以上的种种胡言，都属于我当下这个时刻的想法。<br>以前我会害怕自己下的结论不够准确，不够全面。<br>现在我就不会了，因为我所说的，我所想的，都是我现有水平的结果。<br>以后肯定会变，随着时间，随着眼界的变化。<br>否定之否定，人才能不断地前进。  </p>
<p>当然，当我自己面对死亡的时候：</p>
<pre><code>该崩溃的时候，还是会崩溃。
</code></pre>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2015/07/15/Tao-2015-2015-05-01-theFearOfDeath/" data-id="cjf9gd8a4002gvzzn0jjg0bnj" class="article-share-link">Teilen</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="mobile-Art-2015-2015-05-17-BeckDesignRules" class="article article-type-mobile" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/07/15/Art-2015-2015-05-17-BeckDesignRules/" class="article-date">
  <time datetime="2015-07-15T07:36:32.000Z" itemprop="datePublished">2015-07-15</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Art/">Art</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/07/15/Art-2015-2015-05-17-BeckDesignRules/">Beck Design Rules</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Beck-Design-Rules-（Beck设计规则-A生译）"><a href="#Beck-Design-Rules-（Beck设计规则-A生译）" class="headerlink" title="Beck Design Rules （Beck设计规则 A生译）"></a>Beck Design Rules （Beck设计规则 A生译）</h1><p><img src="/img/2015/kent.jpg" alt="img"></p>
<p>Kent Beck developed Extreme Programming, Test Driven Development, and can always be relied on for good Victorian facial hair for his local ballet.</p>
<p>作者 : Martin Fowler<br>译者 : A生<br><a href="http://martinfowler.com/bliki/BeckDesignRules.html" target="_blank" rel="noopener">原文地址</a></p>
<p>Kent Beck 归纳出他关于简单设计的四条规则，当他在1990年代发明<a href="http://martinfowler.com/bliki/ExtremeProgramming.html" target="_blank" rel="noopener">极限编程</a>的时候。</p>
<p>我将它们概括如下：  </p>
<ul>
<li>通过测试  </li>
<li>展现意图  </li>
<li>没有重复  </li>
<li>极少的元素  </li>
</ul>
<p>规则是按优先级排序的，所以 “通过测试” 比 “展现意图” 有着更高的优先级。  </p>
<p>最重要的规则就是 “通过测试”。<br>XP（极限编程）是关于测试如何在软件开发中上升为一等活动的革命，<br>所以自然地，它应该在那些规则之中扮演着尤其显要的角色。<br>关键点是无论你在软件中干了什么，主要目的是让它如心中所想那样的工作，测试在哪里就是确保它是那样的发生。  </p>
<p>“展现意图” 是Kent的方式去说明代码应该容易被理解。<br>沟通是极限编程的核心价值，很多程序员喜欢这样的认为：程序在哪里就是为了被别人去阅读的。<br>Kent解释这个规则的关键是，能够在代码里去表达你的意图，所以你的读者能够理解你当时写下那段代码的目的。  </p>
<p>“没有重复”可能是那些规则中最有力和微妙的。<br>它在别的地方也叫做 “DRY” or “SPOT” [备注]  的概念,Kent表达它是关于当说起所有的事情时，应该是“一次 只有一次”。<br>许多程序员已经注意到，去除重复是演进好的设计的一种的强力方式。  </p>
<p>最后一条规则告诉我们，任何不服务前面三条规则的，都应该被移走。<br>当这些规则制定的同时，许多设计上的建议是：为了能够增加对未来需求的灵活性，在一个架构上不断地增加元素。<br>具有讽刺意义的是，所有这些元素带来的额外的复杂性，让系统难于修改，因此在实践中的灵活性就更少了。  </p>
<p>人们常常会发现 “没有重复”和“展现意图” 之间有一些争议，导致争论的是这2个规则的优先次序。<br>我经常觉得他们之间的顺序并不重要，因为他们彼此在精炼代码的过程中相互依存。<br>诸如通过增加重复的内容来让代码更加清晰，往往是正在准备去掩盖一个问题，当这个问题将被更好的解决的时候。  </p>
<p><img src="/img/2015/kent-sketch.png" alt="img"></p>
<p>我喜欢这些规则的是记住它们很简单，遵循这些规则可以改进任何一种我用过的语言或编程的范式。<br>它们是Kent寻找普遍适用的原则的能力的其中一个例子，但足以改变我的行为。  </p>
<blockquote>
<p>At the time there was a lot of “design is subjective”, “design is a matter of taste” bullshit going around. I disagreed. There are better and worse designs. These criteria aren’t perfect, but they serve to sort out some of the obvious crap and (importantly) you can evaluate them right now. The real criteria for quality of design, “minimizes cost (including the cost of delay) and maximizes benefit over the lifetime of the software,” can only be evaluated post hoc, and even then any evaluation will be subject to a large bag full of cognitive biases. The four rules are generally predictive.</p>
</blockquote>
<blockquote>
<p>当有很多 “ 设计是主观的 ”,“ 设计是一种品味 ” 废话的时候。<br>我不同意，设计有更好的和更糟糕的。<br>这些标准并不完美,但是它们解决了一些明显的废话，(重要的是)现在你可以评估他们。<br>这四个规则通用地评估：质量设计的真正标准， “ 最小化成本(包括延迟的成本)和最大化效益在软件的生命周期 ” 。<br>而不是那些只能事后评估,甚至任何评估了就将受到一大堆认知偏见的评估。</p>
</blockquote>
<blockquote>
<p>– Kent Beck</p>
</blockquote>
<h2 id="Further-Reading"><a href="#Further-Reading" class="headerlink" title="Further Reading"></a>Further Reading</h2><p><a href="http://martinfowler.com/bliki/BeckDesignRules.html" target="_blank" rel="noopener">原文地址</a></p>
<h2 id="备注"><a href="#备注" class="headerlink" title="备注"></a>备注</h2><p>＊DRY stands for Don’t Repeat Yourself, and comes from The Pragmatic Programmer.<br>SPOT stands for Single Point Of Truth.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2015/07/15/Art-2015-2015-05-17-BeckDesignRules/" data-id="cjf9gd88q001hvzznwxhcv6ja" class="article-share-link">Teilen</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="mobile-Art-2015-2015-05-27-Test-Assert-Mock" class="article article-type-mobile" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/06/14/Art-2015-2015-05-27-Test-Assert-Mock/" class="article-date">
  <time datetime="2015-06-14T08:29:50.000Z" itemprop="datePublished">2015-06-14</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Art/">Art</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/06/14/Art-2015-2015-05-27-Test-Assert-Mock/">Test Assert Mock</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="测试-断言-模拟"><a href="#测试-断言-模拟" class="headerlink" title="测试 断言 模拟 "></a>测试 断言 模拟 </h1><p><img src="/img/2015/test-kind.png" alt="img"></p>
<h1 id="Test"><a href="#Test" class="headerlink" title="Test"></a>Test</h1><p>在很多人眼里，测试是一类东西：交给测试人员做的事情。<br>其实，测试有很多不同的种类（详见上图），不同的测试应用场景也不同。  </p>
<p>跟开发者密切相关的测试有：  </p>
<ul>
<li>提交测试  </li>
<li>单元测试  </li>
<li>组件测试  </li>
<li>集成测试  </li>
</ul>
<h2 id="测试是有成本的。"><a href="#测试是有成本的。" class="headerlink" title="测试是有成本的。"></a><em>测试是有成本的。</em></h2><p>编写要成本，运行要成本，维护更需要成本！  </p>
<p>成本最小的应该是提交测试，顾名思义，提交测试就是提交代码之前必须要运行的测试。<br>如果每次提交都要等个半个小时，那么估计很少人愿意频繁提交代码了。 ：）<br>提交测试的内容应该是单元测试里面比较重要的部分。  </p>
<h2 id="单元测试，必须要快！"><a href="#单元测试，必须要快！" class="headerlink" title="单元测试，必须要快！"></a><em>单元测试，必须要快！</em></h2><p>如何做到唯快不破？ 答案很简单：  </p>
<ul>
<li>No IO  </li>
<li>No DB  </li>
<li>No Network  </li>
</ul>
<p>业务代码不应该依赖：文件IO操作、DB读写，以及网络层面的外部调用。<br>所以好的设计很重要，把业务代码和IO／DB／Network 分离出来，对设计人员要求是有的。<br>DDD（领域驱动开发）在这方面做了很好的研究，例如Repository模式就很好的隔离业务和DB／IO之间的耦合。  </p>
<h2 id="DB／IO-／Network-并不是不重要"><a href="#DB／IO-／Network-并不是不重要" class="headerlink" title="DB／IO ／Network 并不是不重要"></a><em>DB／IO ／Network 并不是不重要</em></h2><p>关于它们的测试放在组件测试和集成测试的范畴,而这2个测试成本也越高。<br>DB和IO操作放在组件测试里去做，RPC之类的远程调用则放在集成测试里。  </p>
<h1 id="Assert"><a href="#Assert" class="headerlink" title="Assert"></a>Assert</h1><h2 id="System-Out-print"><a href="#System-Out-print" class="headerlink" title="System.Out.print()"></a>System.Out.print()</h2><p>在Java的世界里，最简陋的测试莫过于System.Out.print()啦。</p>
<p>假如我们有一个方法，我们期待它能返回数字5.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> anNum = getSomeNum5();</span><br></pre></td></tr></table></figure>
<p>如果采用print的方法，那么我们就直接的写下，</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">System.Out.print(anNum);</span><br></pre></td></tr></table></figure>
<p>然后我们在控制台里看print出的数字，看看是不是5.<br>这样做的缺陷是，必须得人肉验证，你得盯着结果看。  </p>
<h2 id="Junit"><a href="#Junit" class="headerlink" title="Junit"></a>Junit</h2><p>如果你有用过Junit，那么我们就可以使用更高级点的断言了。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by Antinomy on 15/5/27.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SampleTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> anNum = getSomeNum5();</span><br><span class="line">        assertEquals(<span class="number">5</span>,anNum);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">getSomeNum5</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后，我们就可以愉快的运行测试了，很多IDE都会把结果用绿色和红色显示出来。  </p>
<p><img src="/img/2015/test-sample.png" alt="img"></p>
<p>assertEquals(5,anNum)的意思期待的返回的值是5，实际返回的是getSomeNum5()的结果。<br>我们修改一下getSomeNum5()的“bug”，测试就通过了。  </p>
<p><img src="/img/2015/test-sample-2.png" alt="img"></p>
<h2 id="Hamcrest"><a href="#Hamcrest" class="headerlink" title="Hamcrest"></a>Hamcrest</h2><p>那么测试通过了，我们就完事了么？<br>按照TDD的三部曲，红（失败），绿（通过），重构。<br>接下来要做的是重构。为什么要重构？ 因为我们是有追求的人。 ：）  </p>
<p>好吧，如果你也是一个有追求的人，那么让我们来重构吧。<br>assertEquals这个关键字有一些生硬的感觉，代码可读性上一般般。<br>这个时候，我们该祭出神器<a href="http://hamcrest.org/JavaHamcrest/javadoc/1.3/" target="_blank" rel="noopener">Hamcrest</a>了。</p>
<blockquote>
<p>Hamcrest is a library of matchers, which can be combined in to create flexible expressions of intent in tests.</p>
</blockquote>
<p>采用Hamcrest重构过的代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> junit.framework.TestCase.assertEquals;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.hamcrest.core.Is.is;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.Assert.assertThat;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by Antinomy on 15/5/27.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SampleTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> anNum = getSomeNum5();</span><br><span class="line">        assertThat(anNum, is(<span class="number">5</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">getSomeNum5</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">5</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>assertThat(anNum, is(5)); 假设anNum is 5， 可读性层面立马上去了。<br>重构完，如何保证之前的修改不容易扯到蛋？<br>当然是之前写的测试啦，用了成本的投资必须要有回报，所以重新跑一下之前的测试就知道重构的质量如何了。  </p>
<p><img src="/img/2015/test-sample-3.png" alt="img"></p>
<h1 id="Mock"><a href="#Mock" class="headerlink" title="Mock"></a>Mock</h1><p>以上的例子，只是一个很理想的例子。<br>生活中总有许多不如意的事情，比如，如果getSomeNum5()方法不是本地实现的，而是来自于某个神秘的国度。<br>你甚至不知道它是用什么语言实现的，那么测试的难度也提高了很多。  </p>
<p>如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by Antinomy on 15/5/27.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SampleTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Num5 someWhere = <span class="keyword">new</span> SomeWhere();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> anNum = someWhere.getSomeNum5();</span><br><span class="line"></span><br><span class="line">        assertThat(anNum, is(<span class="number">5</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// interface</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Num5</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">getSomeNum5</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// SomeWhere</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SomeWhere</span> <span class="keyword">implements</span> <span class="title">Num5</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getSomeNum5</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">5</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果你知道有一个叫Num5的接口，而它的具体实现是有另外一个团队来实现的，不幸的是那个团队还没完成功能。</p>
<p>难道我们能做的事情只能是等待？？<br><em>NO！</em></p>
<p>我们已经知道接口了，知道它该有的功能是什么。<br>所以我们可以假扮它了，嘿嘿～  </p>
<h2 id="Mockito"><a href="#Mockito" class="headerlink" title="Mockito"></a>Mockito</h2><p>这个时候我们该祭出神器 <a href="http://mockito.org/" target="_blank" rel="noopener">Mockito</a>了。  </p>
<p><img src="/img/2015/test-mockito.png" alt="img"></p>
<blockquote>
<p>Tasty mocking framework for unit tests in Java</p>
</blockquote>
<p>使用Mockito，你就不需要知道真正的SomeWhere是这么实现的，你只需要假扮它。  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.hamcrest.core.Is.is;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.Assert.assertThat;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.mockito.Mockito.mock;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.mockito.Mockito.when;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by Antinomy on 15/5/27.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SampleTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Num5 someWhere = getNum5Mock();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> anNum = someWhere.getSomeNum5();</span><br><span class="line"></span><br><span class="line">        assertThat(anNum, is(<span class="number">5</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> Num5 <span class="title">getNum5Mock</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Num5 result = mock(Num5.class);</span><br><span class="line"></span><br><span class="line">        when(result.getSomeNum5()).thenReturn(<span class="number">5</span>);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在以上的这段代码里，我们并不知道Somewhere是怎么实现的， 我们用了一个假扮的result去模拟Num5接口的实现。<br>when(result.getSomeNum5()).thenReturn(5);<br>当call到getSomeNum5()方法时，then Return 5 了。  </p>
<p>这样，我们就可以在Somewhere团队完成功能之前，模拟返回5，返回不是5的各种情况。<br>事先调试好集成代码，等到他们完工的时候，再切换成真正代码的调用。  </p>
<p><img src="/img/2015/test-sample-4.png" alt="img"></p>
<p><em>mock不是上策，它只是对不完美的设计的一种妥协。</em></p>
<h1 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h1><p>好吧，我们成功地把一句print语句，复杂到要用接口，mock等方式来实现。<br>宇宙的熵就是这么来的，哈哈。</p>
<p><em>写测试的时候需要精心设计测试用例，需要有丰富的想象力，需要有一颗跨界的心。</em></p>
<h1 id="Further-Reading"><a href="#Further-Reading" class="headerlink" title="Further Reading"></a>Further Reading</h1><p><a href="http://dreamhead.blogbus.com/logs/226738756.html" target="_blank" rel="noopener">你应该更新的Java知识之常用程序库（二）</a></p>
<p>[Sample Codes][<a href="https://github.com/Antinomy/Antinomy.github.io/tree/master/sampleCodes/testWithMock/]" target="_blank" rel="noopener">https://github.com/Antinomy/Antinomy.github.io/tree/master/sampleCodes/testWithMock/]</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2015/06/14/Art-2015-2015-05-27-Test-Assert-Mock/" data-id="cjf9gd88w001kvzzne5le84p4" class="article-share-link">Teilen</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="mobile-Tech-2015-2015-04-17-IntelliJTips" class="article article-type-mobile" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/04/17/Tech-2015-2015-04-17-IntelliJTips/" class="article-date">
  <time datetime="2015-04-17T05:57:07.000Z" itemprop="datePublished">2015-04-17</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Tech/">Tech</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/04/17/Tech-2015-2015-04-17-IntelliJTips/">IntelliJ Tips</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="IntelliJ-Tips"><a href="#IntelliJ-Tips" class="headerlink" title="IntelliJ Tips"></a>IntelliJ Tips</h1><p><img src="/img/2015/IntelliJTips1.png" alt="img"></p>
<p>从RAD切换到IntelliJ已有一段时间，学习曲线总的来说，还不是很高。<br>直到我从windows换到Mac系统，一些奇怪到问题也出现了。  </p>
<h1 id="忽然失效的SpringUnitTest"><a href="#忽然失效的SpringUnitTest" class="headerlink" title="忽然失效的SpringUnitTest"></a>忽然失效的SpringUnitTest</h1><p>对我这种不写测试就写不了代码的码农来说，没什么比测试用例突然运行不了更打击人的了。<br>万万没想到，切换到高大上到mbp之后，IntelliJ的SpringUnitTest就跑不起来了。  </p>
<p>看了一下日志，原因是<em>SpringJUnit4ClassRunner</em>无法读取配置文件的路径。<br>在win系统下Eclipse和IntelliJ工作的正常的代码如下：  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith</span>(SpringJUnit4ClassRunner.class)</span><br><span class="line"><span class="meta">@ActiveProfiles</span>(<span class="string">"test"</span>)</span><br><span class="line"><span class="meta">@ContextConfiguration</span>(locations = &#123;<span class="string">"classpath:applicationContext*.xml"</span>&#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>经过一系列的排查和祈祷（囧），问题出在mac版的IntelliJ无法通过 通配符 ＊ 去载入所有的配置文件。<br>修改如下：  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith</span>(SpringJUnit4ClassRunner.class)</span><br><span class="line"><span class="meta">@ContextConfiguration</span>(locations = &#123;</span><br><span class="line">        <span class="string">"classpath:applicationContext.xml"</span>,</span><br><span class="line">        <span class="string">"classpath:applicationContext-IoC.xml"</span>,</span><br><span class="line">        <span class="string">"classpath:applicationContext-persistence.xml"</span>&#125;)</span><br><span class="line"><span class="meta">@ActiveProfiles</span>(<span class="string">"test"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>问题是解决了，具体的因果要深入到IDE的内部工作原理才行了。<br>我最近学会了一件事，不要凡事都非要求个因果。 ：）   </p>
<h2 id="ps：-最终还是完美解决了这个问题："><a href="#ps：-最终还是完美解决了这个问题：" class="headerlink" title="ps： 最终还是完美解决了这个问题："></a>ps： 最终还是完美解决了这个问题：</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith</span>(SpringJUnit4ClassRunner.class)</span><br><span class="line"><span class="meta">@ActiveProfiles</span>(<span class="string">"test"</span>)</span><br><span class="line"><span class="meta">@ContextConfiguration</span>(locations = &#123;<span class="string">"classpath*:applicationContext*.xml"</span>&#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><em>classpath</em> 后面必须加多个*， 在<br><a href="http://docs.spring.io/spring/docs/4.0.1.RELEASE/spring-framework-reference/htmlsingle/#resources-wildcards-in-path-other-stuff" target="_blank" rel="noopener">Spring 文档</a>有提到，不过win平台没有这个问题。。</p>
<p>Other notes relating to wildcards</p>
<p>Please note that “ classpath<em>:” when combined with Ant-style patterns will only work reliably with at least one root directory before the pattern starts, unless the actual target files reside in the file system. This means that a pattern like “ classpath</em>:*.xml” will not retrieve files from the root of jar files but rather only from the root of expanded directories. This originates from a limitation in the JDK’s ClassLoader.getResources() method which only returns file system locations for a passed-in empty string (indicating potential roots to search).</p>
<p>Ant-style patterns with “ classpath:” resources are not guaranteed to find matching resources if the root package to search is available in multiple class path locations. This is because a resource such as</p>
<p>com/mycompany/package1/service-context.xml<br>may be in only one location, but when a path such as</p>
<p>classpath:com/mycompany/*<em>/service-context.xml<br>is used to try to resolve it, the resolver will work off the (first) URL returned by getResource(“com/mycompany”);. If this base package node exists in multiple classloader locations, the actual end resource may not be underneath. Therefore, preferably, use “ classpath</em>:” with the same Ant-style pattern in such a case, which will search all class path locations that contain the root package.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2015/04/17/Tech-2015-2015-04-17-IntelliJTips/" data-id="cjf9gd8az003avzznipvusmy1" class="article-share-link">Teilen</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="mobile-Tech-2015-2015-04-03-KettleTips" class="article article-type-mobile" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/04/04/Tech-2015-2015-04-03-KettleTips/" class="article-date">
  <time datetime="2015-04-04T04:08:01.000Z" itemprop="datePublished">2015-04-04</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Tech/">Tech</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/04/04/Tech-2015-2015-04-03-KettleTips/">Kettle Tips</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Kettle-Tips"><a href="#Kettle-Tips" class="headerlink" title="Kettle Tips"></a>Kettle Tips</h1><p><img src="/img/2015/kettle.png" alt="img"></p>
<p>Kettle作为一个开源的ETL工具，功能也算挺齐全的，当然坑也不会少。：）<br>so A生也小小的分享一下遇到的其中一些坑。</p>
<h1 id="解决中文乱码问题"><a href="#解决中文乱码问题" class="headerlink" title="解决中文乱码问题"></a>解决中文乱码问题</h1><p>DB 链接处设置：</p>
<p><img src="/img/2015/KettleTips1.png" alt="img"></p>
<pre><code>characterEncoding=utf8;
characterSetResults=utf8;
useUnicode=true

去掉简易设置的选项：
</code></pre><p><img src="/img/2015/KettleTips2.png" alt="img">    </p>
<h1 id="更新修改过的表结构"><a href="#更新修改过的表结构" class="headerlink" title="更新修改过的表结构"></a>更新修改过的表结构</h1><p>清除DB的缓存</p>
<p><img src="/img/2015/KettleTips3.png" alt="img"></p>
<h1 id="使用变量"><a href="#使用变量" class="headerlink" title="使用变量"></a>使用变量</h1><p>变量名字不能与Job/Trans命令参数同名，否则变量读取会失效。</p>
<pre><code>变量引用格式 ：    ${param}
</code></pre><h1 id="去掉自动增加的小数点"><a href="#去掉自动增加的小数点" class="headerlink" title="去掉自动增加的小数点"></a>去掉自动增加的小数点</h1><p>输入输出字段定义格式</p>
<p><img src="/img/2015/KettleTips4.png" alt="img"></p>
<h1 id="Kettel-系统配置文件"><a href="#Kettel-系统配置文件" class="headerlink" title="Kettel 系统配置文件"></a>Kettel 系统配置文件</h1><p>在第一次运行kettle之后，kettle会在%HOME_USER_FOLDER%菜单里面创建一个 .kettle文件夹，  </p>
<p>windows  <em>C:\Documents and Settings\${your user name}.kettle\kettle.properties</em><br>linux <em>/home/${your user name }/.kettle/kettle.properties</em>  </p>
<h1 id="命令行运行Job-Trans"><a href="#命令行运行Job-Trans" class="headerlink" title="命令行运行Job/Trans"></a>命令行运行Job/Trans</h1><p><em>Job</em><br>./kitchen.sh -file=? -debug=debug -log=log.log<br><em>Trans</em><br>./pen.sh -file=? -debug=debug -log=log.log  </p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2015/04/04/Tech-2015-2015-04-03-KettleTips/" data-id="cjf9gd8aw0038vzzn8n4cpbv4" class="article-share-link">Teilen</a>
      
      
    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/">&laquo; zurück</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/3/">weiter &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Kategorien</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Art/">Art</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Other/">Other</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Tao/">Tao</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Tech/">Tech</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Buddha/">Buddha</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DDD/">DDD</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/IDDD/">IDDD</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Philosophy/">Philosophy</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TroubleShoot/">TroubleShoot</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Buddha/" style="font-size: 10px;">Buddha</a> <a href="/tags/DDD/" style="font-size: 20px;">DDD</a> <a href="/tags/IDDD/" style="font-size: 15px;">IDDD</a> <a href="/tags/Philosophy/" style="font-size: 10px;">Philosophy</a> <a href="/tags/TroubleShoot/" style="font-size: 10px;">TroubleShoot</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archiv</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">March 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">February 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">October 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/09/">September 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">April 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/11/">November 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/08/">August 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/07/">July 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/06/">June 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/04/">April 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/03/">March 2015</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">letzter Beitrag</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2018/03/27/Tech-2014-2014-09-02-BenefitOfExtractMethod/">Benefit of Extract Method</a>
          </li>
        
          <li>
            <a href="/2018/02/28/Tech-2018-2018-02-27-One-Issue-Cause-By-Id/">One Issue Cause By Id</a>
          </li>
        
          <li>
            <a href="/2016/10/20/Tech-2016-2016-11-09-resinWithJavaEE8/">Resin 3 With JavaEE8</a>
          </li>
        
          <li>
            <a href="/2016/09/13/Tech-2016-2016-09-13-JavaConcurrency/">Java Concurrency</a>
          </li>
        
          <li>
            <a href="/2016/09/12/Tech-2016-2016-09-12-JavaMemModel/">Java Memory Model</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2018 Antinomy Yang<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>