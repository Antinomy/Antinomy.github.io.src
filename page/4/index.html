<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>Anti</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Anti">
<meta property="og:url" content="http://yoursite.com/page/4/index.html">
<meta property="og:site_name" content="Anti">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Anti">
  
    <link rel="alternate" href="/atom.xml" title="Anti" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Anti</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Suche"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="mobile-Art-2014-2014-08-18-IDDD-13" class="article article-type-mobile" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/03/30/Art-2014-2014-08-18-IDDD-13/" class="article-date">
  <time datetime="2015-03-30T14:34:38.000Z" itemprop="datePublished">2015-03-30</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Art/">Art</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/03/30/Art-2014-2014-08-18-IDDD-13/">IDDD 13 Integrate Bounded Context</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="lt-lt-实现领域驱动设计-gt-gt-十三-集成限界上下文"><a href="#lt-lt-实现领域驱动设计-gt-gt-十三-集成限界上下文" class="headerlink" title="&lt;&lt; 实现领域驱动设计 &gt;&gt; 十三: 集成限界上下文"></a>&lt;&lt; 实现领域驱动设计 &gt;&gt; 十三: 集成限界上下文</h1><pre><code>在上下文映射图中，多个限界上下文之间需要进行集成。
</code></pre><p><a href="/img/2014/0818-IDDD_13.png" target="_blank"><br><img src="/img/2014/0818-IDDD_13.png" alt="img"><br></a></p>
<h2 id="MindMapping-Source-Org-Format"><a href="#MindMapping-Source-Org-Format" class="headerlink" title="MindMapping Source (Org Format):"></a>MindMapping Source (Org Format):</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">* 集成限界上下文</span><br><span class="line">  在上下文映射图中，多个限界上下文之间需要进行集成。</span><br><span class="line">** 集成基础</span><br><span class="line">*** 分布式计算原则</span><br><span class="line">    与RPC有着根本性区别</span><br><span class="line">**** 网络是不可靠的</span><br><span class="line">**** 总会存在时间延迟，有时非常严重</span><br><span class="line">**** 带宽是有限的</span><br><span class="line">**** 不要假设网络是安全的</span><br><span class="line">**** 网络拓扑结构将发生变化</span><br><span class="line">**** 知识和政策在多个管理员之间传播</span><br><span class="line">**** 网络传输是有成本的</span><br><span class="line">**** 网络是异构的</span><br><span class="line">*** 跨系统边界交换信息</span><br><span class="line">**** 创建某种形式的消息契约</span><br><span class="line">***** XML</span><br><span class="line">***** JSON</span><br><span class="line">***** 特殊格式</span><br><span class="line">***** 发布语言</span><br><span class="line">** 集成类型</span><br><span class="line">*** 通过REST</span><br><span class="line">**** 服务器端--开放主机服务</span><br><span class="line">**** 客户端--防腐层实现</span><br><span class="line">*** 通过消息</span><br><span class="line">**** 事件驱动架构</span><br><span class="line">**** 长时间处理过程</span><br><span class="line">***** 消息幂等</span><br><span class="line">***** 状态机</span><br><span class="line">***** 超时跟踪器</span><br><span class="line">**** 当消息机制或系统不可用时</span><br><span class="line">     考虑最差后果，以及对策</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2015/03/30/Art-2014-2014-08-18-IDDD-13/" data-id="cjf9gd884000wvzzn1tx5106n" class="article-share-link">Teilen</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/IDDD/">IDDD</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="mobile-Art-2014-2014-11-20-HexArchitecture" class="article article-type-mobile" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/03/30/Art-2014-2014-11-20-HexArchitecture/" class="article-date">
  <time datetime="2015-03-30T14:34:38.000Z" itemprop="datePublished">2015-03-30</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Art/">Art</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/03/30/Art-2014-2014-11-20-HexArchitecture/">Hex Architecture</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="六边形架构"><a href="#六边形架构" class="headerlink" title="六边形架构"></a>六边形架构</h1><p><img src="/img/2014/0721-HexagonalArchitecture.jpg" alt="img"><br>第一次看到六边形架构,是从《IDDD》这本书里看到的,当时就觉得这是和DDD相当match的架构.<br>稍微研究了下,发现Alistair Cockburn这篇<a href="http://alistair.cockburn.us/Hexagonal+architecture" target="_blank" rel="noopener">《Hexagonal Architecture》</a><br>详细地介绍什么是六边形架构,按照惯例, A生假假地的翻译了一下.</p>
<hr>
<h1 id="六边形架构-1"><a href="#六边形架构-1" class="headerlink" title="六边形架构"></a>六边形架构</h1><p>作者 : Alistair Cockburn<br>译者 : A生  </p>
<pre><code>创建一个既不需要UI也不需要DB就能工作的应用程序,那样你就能针对它去运行自动化的回归测试,即使DB挂了也能继续工作,不需要任何用户参与,就能和其他应用程序连接起来.
</code></pre><p><img src="/img/2014/Hexagonal-1.jpg" alt="img"></p>
<h1 id="模式-端口与设配器-“对象结构”"><a href="#模式-端口与设配器-“对象结构”" class="headerlink" title="模式: 端口与设配器 (“对象结构”)"></a>模式: 端口与设配器 (“对象结构”)</h1><hr>
<p><em>别名 : 端口与设配器</em><br><em>别名 : 六边形架构</em>  </p>
<h2 id="意图"><a href="#意图" class="headerlink" title="意图"></a>意图</h2><p>允许一个应用程序平等地被用户,程序,自动化测试和批处理脚本所驱动,可被单独开发和测试于最终运行时的设备和数据库.  </p>
<p>从外面世界进来的事件到达某一个端口,一个技术意义上的设配器把它转换成一个过程调用或消息后传入应用程序.应用程序幸福地忽略输入设备的本来面目.当应用程序发送某些东西出去时,它通过某个端口发送至某个设配器,去创建被接收技术方(人工或自动)所需要的适当的信号.应用程序从语义上通过适配器和各处交互,而不需要去知道设配器另一端的本来面目.</p>
<p><img src="/img/2014/Hexagonal-2.gif" alt="img"></p>
<h1 id="特性-1"><a href="#特性-1" class="headerlink" title="特性 1"></a>特性 1</h1><h2 id="动机"><a href="#动机" class="headerlink" title="动机"></a>动机</h2><p>这些年来软件应用程序里最大的问题之一,就是把业务逻辑渗透在用户接口的代码里.<br>由此引起的问题有三部分:   </p>
<ul>
<li>第一,系统不能被自动化测试套件整洁地测试,因为部分需要被测试的逻辑依赖经常变化的可视化细节,如字段长度和按钮位置等;</li>
<li>因为同样的原因,它变得不可能从一个人肉使用的系统变成一个批处理的系统;</li>
<li>还是同样的原因,当系统开始受欢迎的时候,它变得困难或不可能去允许该程序被另外的程序所驱动.  </li>
</ul>
<p>在许多组织里重复的,一种尝试了的解决方案,就是创建一个分层的架构.<br>在那个时候去承诺,真心诚意地去承诺,没有业务逻辑会放到新的分层里.<br>但是,当发生了破坏承诺的时候,却没有一种机制能够检测出.<br>组织会发现若干年后,新的分层和业务逻辑混在一起,老问题又再次出现了.  </p>
<p>现在想象应用程序提供的“每一片”功能，是以API（application programmed interface) 或函数调用的形式出现。<br>在这种情况下，当任何新的代码破坏现有可工作的功能的时候，测试或QA部门可通过运行自动化测试脚本来针对应用程序去发现问题。<br>业务专家可以在GUI细节最终确定之前，创建自动化测试用例，去告诉程序员，什么才是他们的工作正确完成的时候。（那些测试由测试部门来运行）。<br>应用程序可用“headless”模式去部署，所以只有API是有效的，其他的程序可利用它的功能——简化了整个复杂系统套件的设计，同时也许可了每一个Web上无需人介入的“business-to-business”的应用服务。<br>最后，自动化了功能上的回归测试，检测出了任何违背了把业务逻辑放在表现层之外的承诺。组织可以检测和修正逻辑泄露。  </p>
<p>另外一个类似的有趣问题，什么是被认为是正常的应用程序的“另一边”，那里是应用程序逻辑被绑定在外部的数据库或设备？当数据库服务器停机或进行重大的修订或替换时，程序员就不能继续工作，因为他们的工作绑定在数据库上。这会导致延迟成本和人们会经常感觉到很糟糕。</p>
<p>以上2个问题看起来不是很明显的相关，但它们在自然的解决方案中却显现出了对称性。</p>
<h2 id="自然的解决方案"><a href="#自然的解决方案" class="headerlink" title="自然的解决方案"></a>自然的解决方案</h2><p>客户端和服务器端两边的问题都是因为设计和编程上的同一个错误——业务逻辑和与外部实体交互之间的纠缠不清。<br>不对称的探索，不是在应用程序的“左边”和“右边“之间，而是应该在应用程序的”内部“和”外部“之间。这样的规则履行了与”内部“相关的代码不应该泄露到”外部“去。  </p>
<p>暂时移除任何左右或上下的不对称，我们看到了应用程序通过“端口”与外部代理们沟通。<br>“端口”一词应会引起联想到操作系统层面的端口，任何设备都可以插入使用某种协议的端口那里。同样道理，“端口”在电子产品那，任何设备只要符合规格，都可以插入电子产品里。  </p>
<pre><code>端口的协议就是为了两个设备之间的会话。  
</code></pre><p>这样的协议以API的形式出现。  </p>
<p>每一个外部设备都有一个“设配器”，把API所定义的信号转换到设备所需要的，反之亦然。<br>一个图形化的用户接口或GUI就是一个设配器的例子，映射了一个人在API端口上的动作。<br>其他的设配器在同一个端口上则是自动化测试的安全带，例如FIT或Fitnesse，批处理驱动器，和任何为了应用程序和整体或网络之间沟通的代码。  </p>
<p>在应用程序的另一边，应用程序通过与外部实体沟通来获得数据。<br>数据库协议就是一种经典的协议。<br>从应用程序的角度，如果数据库从一个SQL数据库迁移到一个扁平的文件或其他类型的数据库，通过API的转换应该没有改变。<br>在同一个端口上增加的设配器应该包括一个SQL设配器，一个文件设配器。<br>最重要的，一个去连接到“mock”数据库，一个停留在内存里和完全不依赖真正数据库的设配器。  </p>
<p>许多应用程序只有2个端口：客户端的对话和数据库端的对话。<br>这让他们以不对称的形式出现，从而让看起来像是创建一个一维的，3/4/5层的架构的应用程序。  </p>
<p>这样的图纸会有2个问题。<br>第一、并且是最坏的情况，人们通常不会认真地对待分层中的“边界线”。他们会让应用程序的逻辑泄露在层级边界之外，导致以上所说的问题。<br>第二、应用程序可能会有超过2个以上的端口，所以架构上并不对应一维的层设计。  </p>
<p>六边形(或端口与设配器)架构通过在这种情况下注意到对称性来解决了这些问题：<br>一个应用程序在内部，通过某些端口与外界的东西交互。应用程序外面的东西能够尽早地去处理对称性。  </p>
<p>六边形有意在视觉上突出  </p>
<p>(a) 内外的对称性和相似自然的端口,摆脱了一维层视图和所有的调用,和<br>(b) 不同端口定义的存在数量——2,3 或4个 (4个是我最常遇到的)</p>
<p>六边形不是六边的是因为数字6很重要,而是允许人们进行绘制是有空间去放入他们所需要的端口和设配器,不限制于一维层次的绘制。术语“六边形架构”是来自可视化的效果。  </p>
<p>术语“端口与设配器”拾起了部分绘制的“目的”。端口定义了有目的的会话。通常会有多个设配器对应一个端口，为了多样的技术可插入端口内。 有代表性的，它们可以包括一个电话机器应答，一个人工应答，一个按键式电话，一个图形化人机界面，一个测试装置，一个批处理驱动器，一个http接口，一个程序到程序的接口，一个mock（内存内）数据库，一个真正的数据库（可能有不同的数据库用于开发。测试和实际使用）。  </p>
<p>在应用程序里，左右不对称将再次带出来，无论如何，这个模式的主要目的是集中于内外不对称，从应用程序的角度，假装短暂地识别所有的外面组件。</p>
<h2 id="结构"><a href="#结构" class="headerlink" title="结构"></a>结构</h2><p><img src="/img/2014/Hexagonal-3.gif" alt="img"></p>
<h1 id="特性-2"><a href="#特性-2" class="headerlink" title="特性 2"></a>特性 2</h1><p>特性2显示了一个应用程序有着2个活动端口和用于同一个端口多个设配器。那2个端口分别是应用程序控制方面和数据检索方面。这样的绘制显示出应用程序可以被平等地驱动于：一个自动化、系统级别的回归测试套件，一个人类用户，一个远程的http应用程序，或者另一个应用程序。在数据方面，应用程序从外部数据库解耦，可以被配置运行在一个内存内的Oracle，或“mock”，数据库替换者；或者它可以运行在针对测试的或运行时的数据库。应用程序功能上的规格，或许在用例内，是针对与六边形内部的接口，而不是针对任何一个外部的技术可能用到的接口。   </p>
<p><img src="/img/2014/Hexagonal-4.gif" alt="img"></p>
<h1 id="特性-3"><a href="#特性-3" class="headerlink" title="特性 3"></a>特性 3</h1><p>特性3显示出同一个应用程序对应一个三层架构绘制。每一个端口简化到只有2个适配器。这样的绘制趋势于去显示，多个适配器怎样去适应于顶层和低层，和在开发系统中被用到的，多个适配器之间的序列。编号的箭头显示出一个团队和应用程序可能会用到的次序：</p>
<ol>
<li>用于被应用程序驱动的一个FIT测试设备和用着取代真正数据库的mock（内存内）数据库；  </li>
<li>增加一个GUI到应用程序，仍然跑在mock数据库。  </li>
<li>在集成测试里，针对于一个真正包含测试数据的数据库，运行自动化测试脚本（如从Cruise Control）去驱动应用程序。  </li>
<li>真正地去使用，一个人通过应用程序去访问真正的数据库。  </li>
</ol>
<h2 id="样例代码"><a href="#样例代码" class="headerlink" title="样例代码"></a>样例代码</h2><p>幸运地可以通过FIT的文档，一个最简化应用程序去演示端口与适配器。它是一个简单的折扣计算的应用程序：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">discount(amount) = amount * rate(amount);</span><br></pre></td></tr></table></figure>
<p>在我们的程序里，amount会来自用户和rate会来自一个数据库，所以那里会有2个端口。<br>我们实现它们在以下步骤：</p>
<ul>
<li>测试取代mock数据库的一个固定的rate</li>
<li>然后是GUI</li>
<li>然后是一个可被切换到真正数据库的mock数据库</li>
</ul>
<p><em>感谢在IHC的Gyan Sharma 提供这个例子的代码。</em></p>
<h3 id="步骤1：-FIT-App-constant-as-mock-database"><a href="#步骤1：-FIT-App-constant-as-mock-database" class="headerlink" title="步骤1： FIT App constant-as-mock-database"></a>步骤1： FIT App constant-as-mock-database</h3><p>首先我们创建测试用例通过一个HTML table(看FIT文档如下):</p>
<table><br><tbody><tr><br><td> TestDiscounter </td><td> </td><br></tr><br><tr><br><td> amount  </td><td> discount() </td><br></tr><br><tr><br><td> 100  </td><td> 5 </td><br></tr><br><tr><br><td> 200  </td><td>10 </td><br></tr><br></tbody></table>

<p>注意列名会变成class和function名字在我们的应用程序里。<br>FIT包括了摆脱这种“programmerese”的道路，但是为了这篇文章会简单地把它们放进来。  </p>
<p>知道了那些会是测试的数据，我们创建用户边的设配器，来自FIT里的ColumnFixture如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> fit.ColumnFixture; </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestDiscounter</span> <span class="keyword">extends</span> <span class="title">ColumnFixture</span> </span></span><br><span class="line"><span class="class"></span>&#123; </span><br><span class="line">   <span class="keyword">private</span> Discounter app = <span class="keyword">new</span> Discounter(); </span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">double</span> amount;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">discount</span><span class="params">()</span> </span></span><br><span class="line"><span class="function">   </span>&#123; <span class="keyword">return</span> app.discount(amount); &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>实际上那里的所有都是到设配器的，目前为止，测试可从命令行里运行（看FIT的书会有你所需要的路径）。我们使用这个：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">set FIT_HOME=<span class="regexp">/FIT/</span>FitLibraryForFit15Feb2005</span><br><span class="line">java -cp %FIT_HOME%<span class="regexp">/lib/</span>javaFit1<span class="number">.1</span>b.jar;%FIT_HOME%<span class="regexp">/dist/</span>fitLibraryForFit.jar;src;bin</span><br><span class="line">fit.FileRunner test/Discounter.html TestDiscount_</span><br></pre></td></tr></table></figure>
<p>FIT 生产出一个导出的文件，通过颜色告诉我们那些测试通过了（或者失败，唯一我们在过程中从那里打错了）   </p>
<p>在这个点上的代码已经准备好去check in，集成在Cruise Control或你自己的自动化构建机器里，包括在构建-测试套件里。</p>
<h3 id="步骤2：-UI-App-constant-as-mock-database"><a href="#步骤2：-UI-App-constant-as-mock-database" class="headerlink" title="步骤2： UI App constant-as-mock-database"></a>步骤2： UI App constant-as-mock-database</h3><p>我会让你去创建属于你自己的UI和让它驱动Discounter应用程序，因为代码放在这里有点过长，某些关键的代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">   ...</span><br><span class="line"> Discounter app = <span class="keyword">new</span> Discounter();</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">actionPerformed</span><span class="params">(ActionEvent event)</span> </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ...</span><br><span class="line">   String amountStr = text1.getText();</span><br><span class="line">   <span class="keyword">double</span> amount = Double.parseDouble(amountStr);</span><br><span class="line">   discount = app.discount(amount));</span><br><span class="line">   text3.setText( <span class="string">""</span> + discount );</span><br><span class="line">   ...</span><br></pre></td></tr></table></figure>
<p>在这个点上的代码可以去被演示和回归测试。用户端的设配器都已运行中。</p>
<h3 id="步骤3：-FIT-or-UI-App-mock-database"><a href="#步骤3：-FIT-or-UI-App-mock-database" class="headerlink" title="步骤3：  (FIT or UI) App mock database"></a>步骤3：  (FIT or UI) App mock database</h3><p>去创建一个可替换的数据库端的设配器，我们为一个仓储创建一个“接口”，一个“RepositoryFactory” 会生产出要么模拟数据库、要么真正的服务的对象，在内存里去模拟数据库。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">RateRepository</span> </span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">   <span class="function"><span class="keyword">double</span> <span class="title">getRate</span><span class="params">(<span class="keyword">double</span> amount)</span></span>;</span><br><span class="line"> &#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RepositoryFactory</span> </span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="title">RepositoryFactory</span><span class="params">()</span> </span>&#123;  <span class="keyword">super</span>(); &#125;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> RateRepository <span class="title">getMockRateRepository</span><span class="params">()</span> </span></span><br><span class="line"><span class="function">   </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> MockRateRepository();</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MockRateRepository</span> <span class="keyword">implements</span> <span class="title">RateRepository</span> </span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">getRate</span><span class="params">(<span class="keyword">double</span> amount)</span> </span></span><br><span class="line"><span class="function">   </span>&#123;</span><br><span class="line">      <span class="keyword">if</span>(amount &lt;= <span class="number">100</span>) <span class="keyword">return</span> <span class="number">0.01</span>;</span><br><span class="line">      <span class="keyword">if</span>(amount &lt;= <span class="number">1000</span>) <span class="keyword">return</span> <span class="number">0.02</span>;</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0.05</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p>挂钩这个设配器到Discounter应用程序内，我们需要更改下应用程序自身，去接受使用一个repository设配器，和让（FIT / UI）用户端的设配器传入repository去使用（real or mock）到应用程序的构造函数里。<br>这里有已更改的应用程序和一个FIT设配器传入一个模拟的repository。<br>（FIT设配器的代码，选择是否传入到模拟或真实repository的设配器里，在没有增加太多新的信息情况下有点过长，所以我在这里省略的那个版本）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> repository.RepositoryFactory;</span><br><span class="line"><span class="keyword">import</span> repository.RateRepository;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Discounter</span> </span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">   <span class="keyword">private</span> RateRepository rateRepository;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="title">Discounter</span><span class="params">(RateRepository r)</span> </span></span><br><span class="line"><span class="function">   </span>&#123;</span><br><span class="line">      <span class="keyword">super</span>();</span><br><span class="line">      rateRepository = r;</span><br><span class="line">    &#125;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">discount</span><span class="params">(<span class="keyword">double</span> amount)</span> </span></span><br><span class="line"><span class="function">   </span>&#123;</span><br><span class="line">      <span class="keyword">double</span> rate = rateRepository.getRate( amount ); </span><br><span class="line">      <span class="keyword">return</span> amount * rate;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">import</span> app.Discounter;</span><br><span class="line"><span class="keyword">import</span> fit.ColumnFixture;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestDiscounter</span> <span class="keyword">extends</span> <span class="title">ColumnFixture</span> </span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">   <span class="keyword">private</span> Discounter app = </span><br><span class="line">       <span class="keyword">new</span> Discounter(RepositoryFactory.getMockRateRepository());</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">double</span> amount;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">discount</span><span class="params">()</span> </span></span><br><span class="line"><span class="function">   </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> app.discount( amount );</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>那样就包括了实现六边形架构的最简单的版本。</p>
<p>另外一个不同的实现，使用Ruby和Rack为了浏览器使用，详情：<br><a href="https://github.com/totheralistair/SmallerWebHexagon" target="_blank" rel="noopener">https://github.com/totheralistair/SmallerWebHexagon</a></p>
<h2 id="应用程序指南"><a href="#应用程序指南" class="headerlink" title="应用程序指南"></a>应用程序指南</h2><h3 id="左右不对称"><a href="#左右不对称" class="headerlink" title="左右不对称"></a>左右不对称</h3><p>端口和设配器模式是故意把所有的端口都写上去像是从根本上是相似的。那样的假装在架构层面是有用的。<br>在实现阶段，端口和设配器显示出2种风味，我将其称之为“主要的”和“次要的”，理由很快会揭晓。它们可称之为“驱动”设配器和“被驱动”设配器。  </p>
<p>警觉的读者会注意到所有已给的例子里，FIT fixtures是用了左边端口而mock在右边。<br>在三层的架构里，FIT 坐落在顶层而mock坐落在底层。  </p>
<p>相关的主意是来自“主角”和“次角”的例子。“主角”是驱动了应用程序（改变静止的状态和执行某个已知的功能）。“次角”是被应用程序所驱动的，无论是从中获取应答还是仅仅是通知。“主角”和“次角”的差别是在于谁触发了或者是负责了会话。  </p>
<p>FIT是代替主角的自然测试设配器，从框架设计成读取一个脚本和驱动应用程序开始。<br>mock是代替了“次角”的自然测试设配器，从被设计成从应用程序里去应答查询和记录事件开始。  </p>
<p>这些观察带领我们服从系统的用例上下文图，和在六边形的左边（或顶层）去绘制“主要端口”和“主要适配器”，在六边形的右边（或底层）去绘制“次要端口”和“次要适配器”。  </p>
<p>主次要端口和设配器之间的关系，和他们在FIT和mock的各自实现，记在脑子里是有用的，但应该是用来作为使用端口和设配器架构的结论，而不是简化之。<br>实现端口和设配器的最终好处从一个完全隔离模式敏捷地去运行应用程序。  </p>
<h3 id="用例和应用程序边界"><a href="#用例和应用程序边界" class="headerlink" title="用例和应用程序边界"></a>用例和应用程序边界</h3><p>使用六边形架构模式是有用地去加强，编写用例的首选模式。  </p>
<p>编写用例通常会犯的错误是，在每个端口外面包含了亲密的技术知识。<br>在行业里这种用例获得了众所周知的坏名声，变得冗长，难读，沉闷，易碎，维护昂贵。  </p>
<p>理解端口和设配器模式，我们可以看到用例一般应该写在应用程序边界内（六边形内部），<br>去指定被应用程序所支持的功能和事件，不去管外部的技术。<br>这样用例是简短，易读，更少维护成本，和在时间上更加稳定。</p>
<h3 id="多少端口？"><a href="#多少端口？" class="headerlink" title="多少端口？"></a>多少端口？</h3><p>到底什么是或不是端口，很大程度上只是口味的问题。<br>在极端的情况下，每一个用例只有自己的端口，为了许多的应用程序提供了上百个端口。<br>另外的一种选择，可以想象把所有的主要端口和次要端口融合在一起，到那时3只有2个端口，左边的和右边的。  </p>
<p>没有最好只有更好。   </p>
<p>已知应用的天气预报系统有着4个自然的端口：天气反馈，管理员，通知用户，用户数据库。<br>咖啡售卖机的有4个自然的端口：用户，包括食谱和价格的数据库，售卖机，和硬币箱子。<br>医院的药物系统可能有3个：一个给护士，一个给药方数据库，一个给控制药物分配器。  </p>
<p>选择“错误”数量的端口数不见得会有任何特殊的坏处，所以保持一种直觉即可。<br>我倾向于选择少量的数目，2,3或4，如上所述和已知应用。</p>
<h3 id="已知应用"><a href="#已知应用" class="headerlink" title="已知应用"></a>已知应用</h3><p><img src="/img/2014/Hexagonal-5.gif" alt="img"></p>
<h1 id="特性-4"><a href="#特性-4" class="headerlink" title="特性 4"></a>特性 4</h1><p>特性展现一个有着4个端口并且每个端口都有多个设配器的应用程序。<br>这是从一个应用程序衍生出的监听来自国家天气服务的警报，关于地震，龙卷风，火灾<br>和水灾。和通知人们通过他们的电话或电话对讲机。<br>在我们讨论这个系统的时候，这个系统的接口已确认，从“技术，连接的目的”上讨论过。那里有一个接口为了接收电线上的触发数据，一个为了把通知数据发送到对答的机器上，一个GUI实现的管理接口，和一个获取用户数据的数据库接口。  </p>
<p>人们正在努力，因为他们需要从天气服务增加一个http接口，一个email接口给他们的用户，和他们不得不寻找一种方式可以为了不同的客户采购偏好，绑定和解绑他们增长着的应用程序套件。他们害怕停留在一个维护和测试的噩梦里，因为他们不得不实现，测试和维护所有独立的组合和排列的版本。  </p>
<p>他们修改了设计，在系统接口上根据“目的”而不是根据“技术”去架构，让技术通过设配器变得可以替换（所有方面的）。<br>他们立马提高了速度去包含http订阅和email通知（新的设配器通过虚线绘制出来）。<br>通过APIs让每个应用程序在headless模式下运行，他们可以增加一个 app-to-add 的设配器和解除绑定应用程序套件，按需连接子应用程序。<br>最后，让每一个应用程序可完全独立的执行，通过内置的测试和mock设配器，他们获得了敏捷的通过独立的自动化测试脚本去回归测试他们的应用程序。</p>
<hr>
<h1 id="Mac-Windows-Google-Flickr-Web-2-0"><a href="#Mac-Windows-Google-Flickr-Web-2-0" class="headerlink" title="Mac, Windows, Google, Flickr, Web 2.0"></a>Mac, Windows, Google, Flickr, Web 2.0</h1><p>早在1990时，MacIntosh应用程序如文档处理软件就需要有API驱动的接口，所以应用程序和用户编写的脚本就可以访问应用程序的所有的功能。Windows桌面软件有着同样的能力。（我没有对应的历史知识去说谁先出现，反正那也不是重点）  </p>
<p>如今（2005）web软件的趋势是发布一个公共API去让别的软件直接的访问那些APIs。<br>虽然，那可能会通过google map去发布一些犯罪的数据，或者创建web应用程序包括Flickr在内的相片存档和注释的能力。</p>
<p>所有的这些例子都是关于把“主要的”端口的API可视化， 我们看不到任何信息在次要端口。</p>
<h1 id="Stored-Outputs"><a href="#Stored-Outputs" class="headerlink" title="Stored Outputs"></a>Stored Outputs</h1><p>Willem Bogaerts在C2 wiki上写下这个例子：<br>“我遇到过类似的事情，但是主要是因为我的应用程序层有很强的趋势去变成一个电话切换板去管理它不应该去做的事情。我的应用程序产生输出，显示给用户和有可能会去保存好它。我主要的问题是你不需要常常去储存它。所以我的应用程序产生输出，不得不缓存它和展现给用户。然后，当用户决定要保存导出的数据时，应用程序清空缓冲和真正的保存它。  </p>
<p>我一点都不喜欢这个，于是我想出了一个解决方案：有一个带存储功能的展现控制器。现在应用程序不再需要管道输出到不同的方向，只是简单地输出到展现控制器。展现控制器缓冲了结论和给用户去保存它的可能性。  </p>
<p>传统的架构分层强调“UI”和“存储”是不同的。<br>端口和设配器模式架构可以再简化输出到简单的“输出”。<br>”</p>
<h1 id="来自C2-wiki的匿名例子"><a href="#来自C2-wiki的匿名例子" class="headerlink" title="来自C2-wiki的匿名例子"></a>来自C2-wiki的匿名例子</h1><p>“在我做过的一个项目里，我们使用“真音响设备”的系统隐喻。<br>每一个组件定义了接口，每一个接口都有不同的目的。<br>我们几乎可以通过连线和设配器，没有限制的把组件们连接在一起<br>”</p>
<h1 id="分布式，大团队开发"><a href="#分布式，大团队开发" class="headerlink" title="分布式，大团队开发"></a>分布式，大团队开发</h1><p>这个还在实验阶段的使用和还不能恰当地评估这个模式的使用情况。<br>无论如何，那个很有意思去考虑的。  </p>
<p>不同位置的团队们全去构建六边形架构，用着FIT和mocks，所以应用程序和组件可以独立模式下去测试。CruiseControl每半个小时去运行构建和使用FIT+mock的组合去运行所有的应用程序。因为应用程序子系统和数据库已完整地，替换成mock和测试数据库了。</p>
<h1 id="独立的开发UI和应用程序逻辑"><a href="#独立的开发UI和应用程序逻辑" class="headerlink" title="独立的开发UI和应用程序逻辑"></a>独立的开发UI和应用程序逻辑</h1><p>这个还在早期的实验阶段的使用和还不能恰当地评估这个模式的使用情况。<br>无论如何，那个很有意思去考虑的。  </p>
<p>UI设计是不稳定的，因为它们还未定好是那一种驱动的技术或隐喻。<br>后端服务架构没有定好，事实上它可能在半年内经历过几次改变。<br>尽管如此，项目却是正常地启动和时间是滴答作响的。  </p>
<p>应用程序团队创建FIT测试和mocks去隔离他们的应用程序，创建可测试的，可演示的功能展示给他们的用户。<br>当UI和后端服务最终决定时，它“一个直接的”增加那些元素到应用程序里。<br>开始学习怎样实现它。（或你自己尝试下和写邮件给我）</p>
<hr>
<p>（A生注： 相关模式、感谢和其他引用就不再翻译拉～～ ：） ）</p>
<hr>
<h1 id="Related-Patterns"><a href="#Related-Patterns" class="headerlink" title="Related Patterns"></a>Related Patterns</h1><h2 id="Adapter"><a href="#Adapter" class="headerlink" title="Adapter"></a>Adapter</h2><p>The ‘’Design Patterns’’ book contains a description of the generic ‘’Adapter’’ pattern: “Convert the interface of a class into another interace clients expect.” The ports-and-adapters pattern is a particular use of the ‘’Adapter’’ pattern.</p>
<h2 id="Model-View-Controller"><a href="#Model-View-Controller" class="headerlink" title="Model-View-Controller"></a>Model-View-Controller</h2><p>The MVC pattern was implemented as early as 1974 in the Smalltalk project. It has been given, over the years, many variations, such as Model-Interactor and Model-View-Presenter. Each of these implements the idea of ports-and-adapters on the primary ports, not the secondary ports.</p>
<h2 id="Mock-Objects-and-Loopback"><a href="#Mock-Objects-and-Loopback" class="headerlink" title="Mock Objects and Loopback"></a>Mock Objects and Loopback</h2><p>“A mock object is a “double agent” used to test the behaviour of other objects. First, a mock object acts as a faux implementation of an interface or class that mimics the external behaviour of a true implementation. Second, a mock object observes how other objects interact with its methods and compares actual behaviour with preset expectations. When a discrepancy occurs, a mock object can interrupt the test and report the anomaly. If the discrepancy cannot be noted during the test, a verification method called by the tester ensures that all expectations have been met or failures reported.” — From <a href="http://MockObjects.com" target="_blank" rel="noopener">http://MockObjects.com</a></p>
<p>Fully implemented according to the mock-object agenda, mock objects are used throughout an application, not just at the external interface The primary thrust of the mock object movement is conformance to specified protocol at the individual class and object level. I borrow their word “mock” as the best short description of an in-memory substitute for an external secondary actor.</p>
<p>The Loopback pattern is an explicit pattern for creating an internal replacement for an external device.</p>
<h2 id="Pedestals"><a href="#Pedestals" class="headerlink" title="Pedestals"></a>Pedestals</h2><p>In “Patterns for Generating a Layered Architecture”, Barry Rubel describes a pattern about creating an axis of symmetry in control software that is very similar to ports and adapters. The ‘’Pedestal’’ pattern calls for implementing an object representing each hardware device within the system, and linking those objects together in a control layer. The ‘’Pedestal’’ pattern can be used to describe either side of the hexagonal architecture, but does not yet stress the similarity across adapters. Also, being written for a mechanical control environment, it is not so easy to see how to apply the pattern to IT applications.</p>
<h2 id="Checks"><a href="#Checks" class="headerlink" title="Checks"></a>Checks</h2><p>Ward Cunningham’s pattern language for detecting and handling user input errors, is good for error handling across the inner hexagon boundaries.</p>
<h2 id="Dependency-Inversion-Dependency-Injection-and-SPRING"><a href="#Dependency-Inversion-Dependency-Injection-and-SPRING" class="headerlink" title="Dependency Inversion (Dependency Injection) and SPRING"></a>Dependency Inversion (Dependency Injection) and SPRING</h2><p>Bob Martin’s Dependency Inversion Principle (also called Dependency Injection by Martin Fowler) states that “High-level modules should not depend on low-level modules. Both should depend on abstractions. Abstractions should not depend on details. Details should depend on abstractions.” The ‘’Dependency Injection ‘’pattern by Martin Fowler gives some implementations. These show how to create swappable secondary actor adapters. The code can be typed in directly, as done in the sample code in the article, or using configuration files and having the SPRING framework generate the equivalent code.</p>
<hr>
<hr>
<h1 id="Acknowledgements"><a href="#Acknowledgements" class="headerlink" title="Acknowledgements"></a>Acknowledgements</h1><p>Thanks to Gyan Sharma at Intermountain Health Care for providing the sample code used here. Thanks to Rebecca Wirfs-Brock for her book ‘’Object Design’’, which when read together with the ‘’Adapter’’ pattern from the ‘’Design Patterns’’ book, helped me to understand what the hexagon was about. Thanks also to the people on Ward’s wiki, who provided comments about this pattern over the years (e.g., particularly Kevin Rutherford’s <a href="http://silkandspinach.net/blog/2004/07/hexagonal_soup.html)" target="_blank" rel="noopener">http://silkandspinach.net/blog/2004/07/hexagonal_soup.html)</a>.</p>
<hr>
<h1 id="References-and-Related-Reading"><a href="#References-and-Related-Reading" class="headerlink" title="References and Related Reading"></a>References and Related Reading</h1><p>FIT, A Framework for Integrating Testing: Cunningham, W., online at <a href="http://fit.c2.com" target="_blank" rel="noopener">http://fit.c2.com</a>, and Mugridge, R. and Cunningham, W., ‘’Fit for Developing Software’’, Prentice-Hall PTR, 2005.</p>
<p>The ‘’Adapter’’ pattern: in Gamma, E., Helm, R., Johnson, R., Vlissides, J., ‘’Design Patterns’’, Addison-Wesley, 1995, pp. 139-150.</p>
<p>The ‘’Pedestal’’ pattern: in Rubel, B., “Patterns for Generating a Layered Architecture”, in Coplien, J., Schmidt, D., ‘’PatternLanguages of Program Design’’, Addison-Wesley, 1995, pp. 119-150.</p>
<p>The ‘’Checks’’ pattern: by Cunningham, W., online at <a href="http://c2.com/ppr/checks.html" target="_blank" rel="noopener">http://c2.com/ppr/checks.html</a></p>
<p>The ‘’Dependency Inversion Principle’‘: Martin, R., in ‘’Agile Software Development Principles Patterns and Practices’’, Prentice Hall, 2003, Chapter 11: “The Dependency-Inversion Principle”, and online at <a href="http://www.objectmentor.com/resources/articles/dip.pdf" target="_blank" rel="noopener">http://www.objectmentor.com/resources/articles/dip.pdf</a></p>
<p>The ‘’Dependency Injection’’ pattern: Fowler, M., online at <a href="http://www.martinfowler.com/articles/injection.html" target="_blank" rel="noopener">http://www.martinfowler.com/articles/injection.html</a></p>
<p>The ‘’Mock Object’’ pattern: Freeman, S. online at <a href="http://MockObjects.com" target="_blank" rel="noopener">http://MockObjects.com</a></p>
<p>The ‘’Loopback’’ pattern: Cockburn, A., online at <a href="http://c2.com/cgi/wiki?LoopBack" target="_blank" rel="noopener">http://c2.com/cgi/wiki?LoopBack</a></p>
<p>‘’Use cases:’’ Cockburn, A., ‘’Writing Effective Use Cases’’, Addison-Wesley, 2001, and Cockburn, A., “Structuring Use Cases with Goals”, online at <a href="http://alistair.cockburn.us/crystal/articles/sucwg/structuringucswithgoals.htm" target="_blank" rel="noopener">http://alistair.cockburn.us/crystal/articles/sucwg/structuringucswithgoals.htm</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2015/03/30/Art-2014-2014-11-20-HexArchitecture/" data-id="cjf9gd8a1002dvzzn7z9r9c0v" class="article-share-link">Teilen</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="mobile-Art-2014-2014-07-31-IDDD-8" class="article article-type-mobile" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/03/30/Art-2014-2014-07-31-IDDD-8/" class="article-date">
  <time datetime="2015-03-30T14:34:38.000Z" itemprop="datePublished">2015-03-30</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Art/">Art</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/03/30/Art-2014-2014-07-31-IDDD-8/">IDDD 8 DomainEvent</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="lt-lt-实现领域驱动设计-gt-gt-八-领域事件"><a href="#lt-lt-实现领域驱动设计-gt-gt-八-领域事件" class="headerlink" title="&lt;&lt; 实现领域驱动设计 &gt;&gt; 八: 领域事件"></a>&lt;&lt; 实现领域驱动设计 &gt;&gt; 八: 领域事件</h1><pre><code>用于捕获发生在领域内，领域专家所关心的一些事情
</code></pre><p><a href="/img/2014/0731-IDDD_8.png" target="_blank"><br><img src="/img/2014/0731-IDDD_8.png" alt="img"><br></a></p>
<h2 id="MindMapping-Source-Org-Format"><a href="#MindMapping-Source-Org-Format" class="headerlink" title="MindMapping Source (Org Format):"></a>MindMapping Source (Org Format):</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">* 领域事件</span><br><span class="line">  用于捕获发生在领域内，领域专家所关心的一些事情</span><br><span class="line">** 何时/为什么使用？</span><br><span class="line">*** 当。。。的时候。。</span><br><span class="line">*** 通用语言的正式成员</span><br><span class="line">** 建模</span><br><span class="line">*** 创建具有聚合特征的</span><br><span class="line">**** 发生在过去的事情</span><br><span class="line">**** 应设计成不变的，但拥有唯一标识</span><br><span class="line">*** 身份标识</span><br><span class="line">**** 方便比较</span><br><span class="line">**** 需要发布在外部限界上下文时，唯一标识是必要的</span><br><span class="line">** 发布</span><br><span class="line">*** 从领域模型中发布</span><br><span class="line">**** 观察者模式</span><br><span class="line">***** 发送方</span><br><span class="line">      由聚合创建，并发布出去</span><br><span class="line">***** 订阅方</span><br><span class="line">      由应用/领域服务，向领域事件注册订阅</span><br><span class="line">      与聚合位于相同线程内</span><br><span class="line">*** 向远程限界上下文发布</span><br><span class="line">**** 消息设施的一致性</span><br><span class="line">     最终一致性</span><br><span class="line">***** 领域模型和消息设施，共享持久化存储</span><br><span class="line">***** 领域模型的持久化存储和消息持久化存储，由全局XA事务（两段提交）所控制</span><br><span class="line">***** 领域模型的持久化存储中，创建特殊的存储区域，即事件存储</span><br><span class="line">**** 自治服务和系统</span><br><span class="line">***** 通过领域事件，将任何系统设计成自治服务和系统</span><br><span class="line">***** 避免远程过程调用（RPC）</span><br><span class="line">**** 容许时延</span><br><span class="line">     长时间的事件延迟有可能发生</span><br><span class="line">** 事件存储</span><br><span class="line">*** 作为消息队列使用，将所有领域事件发布出去</span><br><span class="line">*** 基于REST的事件通知</span><br><span class="line">*** 跟踪bug</span><br><span class="line">*** 业务分析和预测</span><br><span class="line">*** 重建聚合</span><br><span class="line">*** 撤销操作</span><br><span class="line">** (向外部)转发存储事件的架构风格</span><br><span class="line">*** 发布事件通知</span><br><span class="line">**** 以REST资源的方式</span><br><span class="line">***** “拉”的方式，非“推”的方式</span><br><span class="line">***** 不能很好支持有顺序的接收</span><br><span class="line">**** 通过消息中间件</span><br><span class="line">** 实现</span><br><span class="line">*** 发布NotifiactionLog</span><br><span class="line">*** 发布基于消息的事件通知</span><br><span class="line">**** 事件消重</span><br><span class="line">***** 幂等操作</span><br><span class="line">      进行多次重复操作和只进行一次操作所产生的结果相同.</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2015/03/30/Art-2014-2014-07-31-IDDD-8/" data-id="cjf9gd88n001evzznnbgiy5rw" class="article-share-link">Teilen</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/DDD/">DDD</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="mobile-Tech-2014-2014-06-29-14Years-Of-XP" class="article article-type-mobile" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/03/30/Tech-2014-2014-06-29-14Years-Of-XP/" class="article-date">
  <time datetime="2015-03-30T14:34:38.000Z" itemprop="datePublished">2015-03-30</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Tech/">Tech</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/03/30/Tech-2014-2014-06-29-14Years-Of-XP/">14 Years of XP</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="14-Years-of-XP"><a href="#14-Years-of-XP" class="headerlink" title="14 Years of XP"></a>14 Years of XP</h1><p>Bob大叔近来发表了一篇文章《<a href="http://blog.8thlight.com/uncle-bob/2013/12/10/Thankyou-Kent.html" target="_blank" rel="noopener">极限编程，一次反思</a>》（<a href="http://www.vaikan.com/extreme-programming-a-reflection/" target="_blank" rel="noopener">译</a>），总结了极限编程（XP，Extreme Programming）这14年来的变化以及发展。</p>
<p>回想我第一次听到XP，已经是10几年前的事情。那时候我还在读大学，刚加入学校的计算机协会，认识了一个编程多年的同学，他介绍我去看下Kent Beck的XP。我当时就想，极限编程，这么花哨的名字肯定不是什么好东西，我还是认真学好我的软件工程好过。直到我出来工作几年，慢慢的接触其中的内容，才发现当时的我是多么的纱布。</p>
<p>所以，当你对有一件事情有偏见的时候，就应该小心地提醒自己，是否被偏见蒙蔽的了自己，最好debug一下自己。 :)</p>
<p><img src="/img/2014/0629-XP.png" alt="img"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">* XP</span><br><span class="line">** Simple Design</span><br><span class="line">** The Planning Game</span><br><span class="line">*** Scrum</span><br><span class="line">*** Kanban</span><br><span class="line">** Testing</span><br><span class="line">*** TDD</span><br><span class="line">**** ATDD</span><br><span class="line">**** BDD</span><br><span class="line">** Small Releases</span><br><span class="line">*** Continues Delivery</span><br><span class="line">** Refactoring</span><br><span class="line">** Metaphor</span><br><span class="line">*** DDD</span><br><span class="line">** Pair Programming</span><br><span class="line">** Collective Ownership</span><br><span class="line">** 40 Hour Week</span><br><span class="line">*** Sustainable Rate</span><br><span class="line">** Coding Standards</span><br><span class="line">** On Site Customer</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2015/03/30/Tech-2014-2014-06-29-14Years-Of-XP/" data-id="cjf9gd8a7002kvzznx2321ks7" class="article-share-link">Teilen</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="mobile-Tech-2014-2014-09-03-IssuesOnUpgradeJekyll-2-2-0" class="article article-type-mobile" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/03/30/Tech-2014-2014-09-03-IssuesOnUpgradeJekyll-2-2-0/" class="article-date">
  <time datetime="2015-03-30T14:34:38.000Z" itemprop="datePublished">2015-03-30</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Tech/">Tech</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/03/30/Tech-2014-2014-09-03-IssuesOnUpgradeJekyll-2-2-0/">Issues On Upgrade Jekyll-2.2.0</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Jekyll-2-2-0-的坑"><a href="#Jekyll-2-2-0-的坑" class="headerlink" title="Jekyll-2.2.0 的坑"></a>Jekyll-2.2.0 的坑</h1><p>手痒把Jekyll升级到2.2.0的时候,发现服务已经启动不起来了. @_@ |||</p>
<p>折腾了一阵子,搞定了中间出现的几个问题, 终于正常了. ^_^</p>
<p><img src="/img/2014/jekyll2.2.0.png" alt="img"></p>
<hr>
<h2 id="问题1-JavaScript-runtime-Issue"><a href="#问题1-JavaScript-runtime-Issue" class="headerlink" title="问题1 : JavaScript runtime Issue"></a>问题1 : JavaScript runtime Issue</h2><p><em>Could not find a JavaScript runtime.</em></p>
<p>Jekyll 2.2.0比起旧版本需要多一个Js runtime, 装个node.js fixed.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install nodejs</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="问题2-pygments-Issue"><a href="#问题2-pygments-Issue" class="headerlink" title="问题2: pygments Issue"></a>问题2: pygments Issue</h2><p><em>Deprecation: The ‘pygments’ configuration option has been renamed to ‘highlighter’. Please update your config file accordingly. The allowed values are ‘rouge’, ‘pygments’ or null.</em></p>
<p>pygments (代码高亮插件)在 _config.yml的配置格式改变了.</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">pygments:</span> <span class="literal">true</span>  --&gt;  <span class="symbol">highlighter:</span> pygments</span><br></pre></td></tr></table></figure>
<hr>
<p>最后重新启动下服务,搞定!</p>
<pre><code>jekyll serve --watch
</code></pre><p><img src="/img/2014/jekyll2.2.0-Done.png" alt="img"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2015/03/30/Tech-2014-2014-09-03-IssuesOnUpgradeJekyll-2-2-0/" data-id="cjf9gd8ab002pvzzn5ar0bg84" class="article-share-link">Teilen</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="mobile-Tech-2014-2014-09-06-Bootstrap-WayOfResponsiveWebDesign" class="article article-type-mobile" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/03/30/Tech-2014-2014-09-06-Bootstrap-WayOfResponsiveWebDesign/" class="article-date">
  <time datetime="2015-03-30T14:34:38.000Z" itemprop="datePublished">2015-03-30</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Tech/">Tech</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/03/30/Tech-2014-2014-09-06-Bootstrap-WayOfResponsiveWebDesign/">Bootstrap - Way Of Responsive Web Design</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Bootstrap-响应式Web设计之道"><a href="#Bootstrap-响应式Web设计之道" class="headerlink" title="Bootstrap - 响应式Web设计之道"></a>Bootstrap - 响应式Web设计之道</h1><p>建立自己的个人blog也有一段时间的，跟用其他著名的blog不一样。所有事情都可以享受DIY的乐趣，当然，也有付出不少的时间。基本功能也搞的7788， 就是用手机端查看博客的时候，排版差劲的很。基于后PC时代，移动设备的时代也开始了。稍微百谷歌度之后，还是有简单的解决方案的——Bootstrap。</p>
<blockquote>
<h2 id="什么是-Bootstrap？"><a href="#什么是-Bootstrap？" class="headerlink" title="什么是 Bootstrap？"></a>什么是 <a href="http://getbootstrap.com/" target="_blank" rel="noopener">Bootstrap</a>？</h2><p>应用<a href="http://www.w3cschool.cc/bootstrap/bootstrap-intro.html" target="_blank" rel="noopener">w3cschool</a>的定义:<br>Bootstrap 是一个用于快速开发 Web 应用程序和网站的前端框架。Bootstrap 是基于 HTML、CSS、JAVASCRIPT 的。</p>
</blockquote>
<h2 id="Bootstrap-的网格系统（Grid-System）"><a href="#Bootstrap-的网格系统（Grid-System）" class="headerlink" title="Bootstrap 的网格系统（Grid System）"></a>Bootstrap 的网格系统（Grid System）</h2><p>Grid System是基于移动设备优先策略,简单实现多设备自适应layout的关键。<br>通过不同的class设定就能实现不同的布局：<br><a href="/img/2014/0824-IDDD.png" target="_blank"><br><img src="/img/2014/Bootstarp-1.png" alt="img"><br></a></p>
<p>e.g. 以下HTML Code，就能简单地实现响应式布局</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container-fluid"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"row"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-xs-12 col-md-offset-1"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        content </span><br><span class="line">        <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="Bootstrap-的必要文件"><a href="#Bootstrap-的必要文件" class="headerlink" title="Bootstrap 的必要文件"></a>Bootstrap 的必要文件</h2><p>除了Bootstrap自己的CSS和字体,Jquery的库也是要的,官方下载后放入自己的路径下即可</p>
<p><img src="/img/2014/Bootstarp-5.png" alt="img"></p>
<h2 id="最终效果如下-不同设备下不同的自适应布局"><a href="#最终效果如下-不同设备下不同的自适应布局" class="headerlink" title="最终效果如下,不同设备下不同的自适应布局:"></a>最终效果如下,不同设备下不同的自适应布局:</h2><pre><code>大屏幕
</code></pre><p><img src="/img/2014/Bootstarp-2.png" alt="img"></p>
<pre><code>中屏幕
</code></pre><p><img src="/img/2014/Bootstarp-3.png" alt="img"></p>
<pre><code>小屏幕
</code></pre><p><img src="/img/2014/Bootstarp-4.png" alt="img"></p>
<hr>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2015/03/30/Tech-2014-2014-09-06-Bootstrap-WayOfResponsiveWebDesign/" data-id="cjf9gd8ad002svzzn2j4yj37d" class="article-share-link">Teilen</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="mobile-Tech-2014-2014-09-25-MindMapping-ChoiceOnTools" class="article article-type-mobile" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/03/30/Tech-2014-2014-09-25-MindMapping-ChoiceOnTools/" class="article-date">
  <time datetime="2015-03-30T14:34:38.000Z" itemprop="datePublished">2015-03-30</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Tech/">Tech</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/03/30/Tech-2014-2014-09-25-MindMapping-ChoiceOnTools/">MindMapping - Choice on Tools</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="MindMapping-工具的选择"><a href="#MindMapping-工具的选择" class="headerlink" title="MindMapping - 工具的选择"></a>MindMapping - 工具的选择</h1><p> 从中学的时候接触一本叫《学习的革命》的书开始，学会了用思维导图来分析问题和记录笔记。<br> 而我用来制作思维导图的工具，也一直在变化。<br> 工具的变化，其实反映的是我思维方式的变化。  </p>
<h1 id="纸笔"><a href="#纸笔" class="headerlink" title="纸笔"></a>纸笔</h1><p><img src="/img/2014/MindMapping-Tools-1.jpg" alt="img"><br> 通过纸和笔，可以无阻力的制作思维导图。<br> 适合临时性的创作，不适合需要反复修改的情形。  </p>
<h2 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h2><pre><code>不会被工具所限制，思维无阻
</code></pre><h2 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h2><pre><code>难以携带和分享
</code></pre><h1 id="手机：App"><a href="#手机：App" class="headerlink" title="手机：App"></a>手机：App</h1><p> 手机的App就非常方便随身携带，但是屏幕太小，思维阻力最大。<br><img src="/img/2014/MindMapping-Tools-2.jpg" alt="img">  </p>
<h2 id="优点-1"><a href="#优点-1" class="headerlink" title="优点"></a>优点</h2><pre><code>随时随地记录思维，易携带和分享
</code></pre><h2 id="缺点-1"><a href="#缺点-1" class="headerlink" title="缺点"></a>缺点</h2><pre><code>屏幕有限，思维阻力大
</code></pre><h1 id="PC-Website"><a href="#PC-Website" class="headerlink" title="PC Website"></a>PC Website</h1><p> 通过在线的网站来制作简单，但是受限于网络环境。<br> 网速不好的时候，思维阻力也大。<br><img src="/img/2014/MindMapping-Tools-3.png" alt="img">  </p>
<h2 id="优点-2"><a href="#优点-2" class="headerlink" title="优点"></a>优点</h2><pre><code>无需客户端，打开网页即可，便于分享
</code></pre><h2 id="缺点-2"><a href="#缺点-2" class="headerlink" title="缺点"></a>缺点</h2><pre><code>受限制于网络环境，思维阻力大
</code></pre><h1 id="PC-Client：FreeMind-Xmind"><a href="#PC-Client：FreeMind-Xmind" class="headerlink" title="PC Client：FreeMind/Xmind"></a>PC Client：FreeMind/Xmind</h1><p> 通过PC客户端（FreeMind/Xmind）来制作就不会受限于网速，相对思维阻力较小。<br> 但是其格式一般基于XML or 其他格式，可读性差，对版本控制不友好。<br><img src="/img/2014/MindMapping-Tools-4.png" alt="img">  </p>
<h2 id="优点-3"><a href="#优点-3" class="headerlink" title="优点"></a>优点</h2><pre><code>不受限于网络环境，思维阻力小
</code></pre><h2 id="缺点-3"><a href="#缺点-3" class="headerlink" title="缺点"></a>缺点</h2><pre><code>难以版本控制，分享不方便
</code></pre><h1 id="最终方案：-Org-text"><a href="#最终方案：-Org-text" class="headerlink" title="最终方案： Org text"></a>最终方案： Org text</h1><p> 经过了种种工具的试用，我最终找到了适合自己的工具。<br> Emacs下的Org模式，基于纯文本，版本控制和可读性最好。<br> 对版本控制也很友好，还可以导出MM格式来由FreeMind/Xmind来进行优化。<br> 唯一复杂的就是中间多了一层，有利必有弊嘛。<br><img src="/img/2014/MindMapping-Tools-5.png" alt="img">  </p>
<h2 id="优点-4"><a href="#优点-4" class="headerlink" title="优点"></a>优点</h2><pre><code>纯文本格式，版本控制友好
制作简单，思维阻力最小。
可导出MM格式，通过第三方美化
</code></pre><h2 id="缺点-4"><a href="#缺点-4" class="headerlink" title="缺点"></a>缺点</h2><pre><code>多了一层中间层，略复杂
</code></pre>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2015/03/30/Tech-2014-2014-09-25-MindMapping-ChoiceOnTools/" data-id="cjf9gd8af002uvzznv719e3bm" class="article-share-link">Teilen</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="mobile-Art-2014-2014-08-01-IDDD-10" class="article article-type-mobile" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/03/30/Art-2014-2014-08-01-IDDD-10/" class="article-date">
  <time datetime="2015-03-30T14:34:38.000Z" itemprop="datePublished">2015-03-30</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Art/">Art</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/03/30/Art-2014-2014-08-01-IDDD-10/">IDDD 10 Aggregate</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="lt-lt-实现领域驱动设计-gt-gt-十-聚合"><a href="#lt-lt-实现领域驱动设计-gt-gt-十-聚合" class="headerlink" title="&lt;&lt; 实现领域驱动设计 &gt;&gt; 十: 聚合"></a>&lt;&lt; 实现领域驱动设计 &gt;&gt; 十: 聚合</h1><pre><code>聚合由实体和值对象在一致性边界内组成，却是最不容易理解的。 
</code></pre><p><a href="/img/2014/0801-IDDD_10.png" target="_blank"><br><img src="/img/2014/0801-IDDD_10.png" alt="Alt text"><br></a></p>
<h2 id="MindMapping-Source-Org-Format"><a href="#MindMapping-Source-Org-Format" class="headerlink" title="MindMapping Source (Org Format):"></a>MindMapping Source (Org Format):</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">* 聚合</span><br><span class="line">** 原则</span><br><span class="line">*** 在一致性边界内建模真正的不变条件</span><br><span class="line">**** 不变的业务规则</span><br><span class="line">**** 事务一致性</span><br><span class="line">**** 一致性边界</span><br><span class="line">*** 设计小聚合</span><br><span class="line">**** 更好性能和伸缩性</span><br><span class="line">**** 根实体</span><br><span class="line">     Root Entity</span><br><span class="line">*** 通过唯一标识引用其他聚合</span><br><span class="line">**** 通过标识引用使多个聚合协调工作</span><br><span class="line">**** 建模对象导航性</span><br><span class="line">***** 失联领域模型</span><br><span class="line">      （Disconnected Domain Model）</span><br><span class="line">****** 资源库</span><br><span class="line">****** 领域服务</span><br><span class="line">***** 通过应用服务来处理依赖关系</span><br><span class="line">**** 不在同个事务中修改多个聚合实例</span><br><span class="line">*** 在边界之外使用最终一致性</span><br><span class="line">**** 由边界内来控制一致性 — — 事务一致性</span><br><span class="line">**** 由边界外来控制一致性 — — 最终一致性</span><br><span class="line">** 打破原则的理由</span><br><span class="line">   有很多因素需要我们做出妥协，但不应该找各种借口来打破原则。</span><br><span class="line">*** 方便用户界面</span><br><span class="line">*** 缺乏技术支持</span><br><span class="line">*** 全局事务</span><br><span class="line">*** 查询性能</span><br><span class="line">** 通过发现，深入理解</span><br><span class="line">*** 重新思考设计</span><br><span class="line">*** 估算聚合成本</span><br><span class="line">*** 常用用例场景</span><br><span class="line">*** 内存消耗</span><br><span class="line">*** 探索另外的设计</span><br><span class="line">*** 实现最终一致性</span><br><span class="line">** 实现</span><br><span class="line">*** 创建具有唯一标识的根实体</span><br><span class="line">    将实体建模成聚合根（Aggregate Root）</span><br><span class="line">*** 优先使用值对象</span><br><span class="line">*** 迪米特法则和“告诉非询问”原则</span><br><span class="line">**** Law of Dememter</span><br><span class="line">***** “最小知识”原则</span><br><span class="line">***** 任何对象的任何方法只能调用</span><br><span class="line">****** 自身</span><br><span class="line">****** 传入的参数对象</span><br><span class="line">****** 它所创建的对象</span><br><span class="line">****** 自身包含的其他对象，并且拥有直接访问权</span><br><span class="line">**** Tell, Dont Ask</span><br><span class="line">***** 一个对象不应该被告知该怎么做</span><br><span class="line">*** 乐观并发</span><br><span class="line">**** 为根实体创建版本号</span><br><span class="line">**** 合理控制版本号</span><br><span class="line">*** 避免依赖注入</span><br><span class="line">**** 在聚合内注入 资源库/领域服务 有害，可在应用服务中使用</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2015/03/30/Art-2014-2014-08-01-IDDD-10/" data-id="cjf9gd87t000mvzzncxoepz2a" class="article-share-link">Teilen</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/IDDD/">IDDD</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="mobile-Art-2014-2014-07-31-IDDD-9" class="article article-type-mobile" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/03/30/Art-2014-2014-07-31-IDDD-9/" class="article-date">
  <time datetime="2015-03-30T14:34:38.000Z" itemprop="datePublished">2015-03-30</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Art/">Art</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/03/30/Art-2014-2014-07-31-IDDD-9/">IDDD 9 Module</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="lt-lt-实现领域驱动设计-gt-gt-九-模块"><a href="#lt-lt-实现领域驱动设计-gt-gt-九-模块" class="headerlink" title="&lt;&lt; 实现领域驱动设计 &gt;&gt; 九: 模块"></a>&lt;&lt; 实现领域驱动设计 &gt;&gt; 九: 模块</h1><pre><code>模块是命名的容器，通用语言的重要组成部分。
</code></pre><p><a href="/img/2014/0731-IDDD_9.png" target="_blank"><br><img src="/img/2014/0731-IDDD_9.png" alt="Alt text"><br></a></p>
<h2 id="MindMapping-Source-Org-Format"><a href="#MindMapping-Source-Org-Format" class="headerlink" title="MindMapping Source (Org Format):"></a>MindMapping Source (Org Format):</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">* 模块</span><br><span class="line">** Module</span><br><span class="line">*** Java</span><br><span class="line">**** package</span><br><span class="line">*** C<span class="comment">#</span></span><br><span class="line">**** <span class="keyword">namespace</span></span><br><span class="line">*** <span class="title">Ruby</span></span><br><span class="line">**** <span class="title">module</span></span><br><span class="line">** 通过模块完成设计</span><br><span class="line">*** 命名的容器</span><br><span class="line">*** 通用语言的重要组成部分</span><br><span class="line">*** 设计规则</span><br><span class="line">**** 和领域概念协调一致</span><br><span class="line">**** 根据通用语言来命名模块</span><br><span class="line">**** 不要机械式根据组件类型来创建</span><br><span class="line">     <span class="title">eg</span> 所有领域服务放在一起</span><br><span class="line">**** 松耦合</span><br><span class="line">**** 杜绝循环依赖</span><br><span class="line">**** 父子模块放松原则</span><br><span class="line">**** 不是静态概念，与模型的对象一道进行建模</span><br><span class="line">** 模块的基本命名规范</span><br><span class="line">*** 层级形式命名</span><br><span class="line">*** 避免顶级模块名与第三方模块命名冲突</span><br><span class="line">** 领域模型的命名规范</span><br><span class="line">*** 加入限界上下文名</span><br><span class="line">*** *.domain.model</span><br><span class="line">** 其他层的模块</span><br><span class="line">*** 分层架构命名</span><br><span class="line">*** 需要时才划分子模块</span><br><span class="line">** 先考虑模块，再考虑上下文</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2015/03/30/Art-2014-2014-07-31-IDDD-9/" data-id="cjf9gd87r000jvzzn4lbi0x0o" class="article-share-link">Teilen</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/IDDD/">IDDD</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="mobile-Art-2014-2014-07-27-IDDD-6" class="article article-type-mobile" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/03/30/Art-2014-2014-07-27-IDDD-6/" class="article-date">
  <time datetime="2015-03-30T14:34:38.000Z" itemprop="datePublished">2015-03-30</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Art/">Art</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/03/30/Art-2014-2014-07-27-IDDD-6/">IDDD 6 ValueObject</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="lt-lt-实现领域驱动设计-gt-gt-六-值对象"><a href="#lt-lt-实现领域驱动设计-gt-gt-六-值对象" class="headerlink" title="&lt;&lt; 实现领域驱动设计 &gt;&gt; 六: 值对象"></a>&lt;&lt; 实现领域驱动设计 &gt;&gt; 六: 值对象</h1><pre><code>值对象易于开发、测试和维护。
尽量使用值对象来建模，而不是实体。
</code></pre><p><a href="/img/2014/0727-IDDD_6.png" target="_blank"><br><img src="/img/2014/0727-IDDD_6.png" alt="img"><br></a></p>
<h2 id="MindMapping-Source"><a href="#MindMapping-Source" class="headerlink" title="MindMapping Source:"></a>MindMapping Source:</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">* 值对象</span><br><span class="line">** 特征</span><br><span class="line">*** 度量或描述</span><br><span class="line">    度量或描述领域中的一件东西</span><br><span class="line">*** 不变性</span><br><span class="line">**** 只读，创建后不改变</span><br><span class="line">**** 只通过构造函数赋值</span><br><span class="line">*** 概念整体</span><br><span class="line">**** 整体值对象</span><br><span class="line">     （Whole Value aka Value Object）</span><br><span class="line">*** 可替换性</span><br><span class="line">*** 相等性</span><br><span class="line">*** 无副作用行为</span><br><span class="line">**** 无副作用函数</span><br><span class="line">     （Side-Effect-Free <span class="function"><span class="keyword">Function</span>)</span></span><br><span class="line"><span class="function">** 最小化集成</span></span><br><span class="line"><span class="function">*** 更少的职责假设</span></span><br><span class="line"><span class="function">** 表示标准类型</span></span><br><span class="line"><span class="function">*** <span class="title">Java</span>里可用枚举来表示</span></span><br><span class="line"><span class="function">** 测试</span></span><br><span class="line"><span class="function">*** <span class="title">TDD</span></span></span><br><span class="line"><span class="function">** 实现</span></span><br><span class="line"><span class="function">*** 2个构造函数</span></span><br><span class="line"><span class="function">**** 1.接受所有参数的</span></span><br><span class="line"><span class="function">**** 2.浅复制其他值对象的</span></span><br><span class="line"><span class="function">     （<span class="title">Shallow</span> <span class="title">Copy</span>）</span></span><br><span class="line"><span class="function">** 持久化</span></span><br><span class="line"><span class="function">*** 拒绝数据建模泄露</span></span><br><span class="line"><span class="function">**** 数据建模式次要的</span></span><br><span class="line"><span class="function">     根据领域模型来设计数据模型，</span></span><br><span class="line"><span class="function">     而不是根据数据模型来设计领域模型</span></span><br><span class="line"><span class="function">*** 与<span class="title">ORM</span></span></span><br><span class="line"><span class="function">**** 单个值对象</span></span><br><span class="line"><span class="function">***** 直接映射</span></span><br><span class="line"><span class="function">**** 保存多个值对象</span></span><br><span class="line"><span class="function">***** 序列化到单个列</span></span><br><span class="line"><span class="function">****** 缺点</span></span><br><span class="line"><span class="function">******* 列宽限制</span></span><br><span class="line"><span class="function">	<span class="title">MySQL</span> <span class="title">Varchar</span> <span class="title">limit</span> ：65535</span></span><br><span class="line"><span class="function">******* 不能查询</span></span><br><span class="line"><span class="function">	其内在属性不能作为<span class="title">SQl</span>查询条件</span></span><br><span class="line"><span class="function">******* 需自定义类型</span></span><br><span class="line"><span class="function">***** 使用数据库实体</span></span><br><span class="line"><span class="function">****** 缺点</span></span><br><span class="line"><span class="function">******* 对象-关系抗阻</span></span><br><span class="line"><span class="function">***** 使用联合表</span></span><br><span class="line"><span class="function">****** 缺点</span></span><br><span class="line"><span class="function">******* 需满足数据库范式</span></span><br><span class="line"><span class="function">******* 每一个属性都不应该为<span class="title">NULL</span></span></span><br><span class="line"><span class="function">******* 不能包含嵌套的集合</span></span><br><span class="line"><span class="function">**** 枚举状态对象</span></span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2015/03/30/Art-2014-2014-07-27-IDDD-6/" data-id="cjf9gd87o000fvzzn7fjb7w6k" class="article-share-link">Teilen</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/DDD/">DDD</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/3/">&laquo; zurück</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/5/">weiter &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Kategorien</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Art/">Art</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Other/">Other</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Tao/">Tao</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Tech/">Tech</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Buddha/">Buddha</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DDD/">DDD</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/IDDD/">IDDD</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Philosophy/">Philosophy</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TroubleShoot/">TroubleShoot</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Buddha/" style="font-size: 10px;">Buddha</a> <a href="/tags/DDD/" style="font-size: 20px;">DDD</a> <a href="/tags/IDDD/" style="font-size: 15px;">IDDD</a> <a href="/tags/Philosophy/" style="font-size: 10px;">Philosophy</a> <a href="/tags/TroubleShoot/" style="font-size: 10px;">TroubleShoot</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archiv</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">March 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">February 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">October 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/09/">September 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">April 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/11/">November 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/08/">August 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/07/">July 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/06/">June 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/04/">April 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/03/">March 2015</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">letzter Beitrag</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2018/03/27/Tech-2014-2014-09-02-BenefitOfExtractMethod/">Benefit of Extract Method</a>
          </li>
        
          <li>
            <a href="/2018/02/28/Tech-2018-2018-02-27-One-Issue-Cause-By-Id/">One Issue Cause By Id</a>
          </li>
        
          <li>
            <a href="/2016/10/20/Tech-2016-2016-11-09-resinWithJavaEE8/">Resin 3 With JavaEE8</a>
          </li>
        
          <li>
            <a href="/2016/09/13/Tech-2016-2016-09-13-JavaConcurrency/">Java Concurrency</a>
          </li>
        
          <li>
            <a href="/2016/09/12/Tech-2016-2016-09-12-JavaMemModel/">Java Memory Model</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2018 Antinomy Yang<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>